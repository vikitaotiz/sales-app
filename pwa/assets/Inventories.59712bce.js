import{Q as f,a as ve}from"./QTr.812082b5.js";import{cp as fe,c1 as ye,r as c,j as _e,aJ as y,a6 as L,u as m,Q as r,a4 as x,bb as l,d as t,ad as u,bD as j,a5 as B,bE as g,a7 as p,ax as ge}from"./index.fa4385c5.js";import{Q as U}from"./QInput.9694c633.js";import{Q as be}from"./QBtnGroup.a0b376e3.js";import{Q as Qe,c as S,d as ke}from"./QSpace.24bc44b2.js";import{a as W,Q as T}from"./QToolbar.816160ea.js";import{Q as X,b as A}from"./QCard.4da288be.js";import{o as Z,n as ee,j as te,k as ae,i as he}from"./rtl.f6ac1500.js";import{e as we,a as Ie}from"./excel.5d19a2ad.js";import{a as Ce}from"./use-quasar.0d0cec89.js";import{a as Ve,u as le}from"./index.b8dd7cb3.js";import{g as qe,p as G}from"./module_calls.606d4328.js";import{u as Pe}from"./product-store.097a19da.js";import{u as xe}from"./auth-store.08242815.js";import{h as ne}from"./helpers.22d5b68c.js";import"./QSeparator.438186f9.js";const re=[{name:"product",required:!0,label:"Product",align:"left",field:o=>o.name,format:o=>`${o}`,sortable:!0},{name:"buying_price",align:"center",label:"Buying Price (Per Unit)",field:"buying_price",sortable:!0},{name:"quantity",align:"center",label:"Quantity",field:"quantity",sortable:!0},{name:"total",align:"center",label:"Total Cost",field:"total",sortable:!0},{name:"measurement",align:"center",label:"Measurement",field:"measurement",sortable:!0},{name:"department",align:"center",label:"Department",field:"department",sortable:!0},{name:"user",align:"center",label:"Created By",field:"user",sortable:!0},{name:"created_at",align:"center",label:"Created On",field:"created_at",sortable:!0},{name:"actions",align:"center",label:"Actions",field:"created_at"}],I=fe(),b=I==null?void 0:I.token,Be=ye("inventories",{state:()=>({inventories:[]}),actions:{async fetchInventories(){if(b){const o=await qe("inventories",b);return this.inventories=o==null?void 0:o.data,this.inventories}},async createInventory(o){var Q;if(o.user_uuid=(Q=I==null?void 0:I.user)==null?void 0:Q.uuid,b)return await G(o,"inventories",b)},async updateInventory(o){if(b)return await G(o,"update_inventory",b)},async deleteInventory(o){if(b)return await G(o,"delete_inventory",b)}}});const Ue={class:"q-pa-md"},Se={key:0},Te={key:1},Ae={class:"text-center error_msg"},De={class:"text-h6"},Ee={key:0},Ne=p("br",null,null,-1),$e={class:"text-center error_msg"},tt={__name:"Inventories",setup(o){const Q=xe(),O=Ce(),D=Ve(),E=Be(),J=Pe(),w=c(!1),_=c(!1),C=c(!1),N=c(!1),z=c(""),V=c(""),i=c(1),d=c(1),s=_e({product_id:"",measurement_id:""}),F=c(""),k=c("");let $=[];const{data:R,isLoading:oe,isError:Y}=le("inventories",()=>E.fetchInventories());le("products",()=>J.fetchProducts(),{onSuccess:n=>{$=n.map(a=>({name:a.name,uuid:a.uuid,quantity:a.quantity,measurement:a.measurement,buying_price:a.buying_price}))}});const M=c($),ue=(n,a)=>{if(n===""){a(()=>{M.value=$});return}a(()=>{const e=n.toLowerCase();M.value=$.filter(h=>h.name.toLowerCase().indexOf(e)>-1)})},se=async n=>{if(confirm(`Continue with the operation. Delete ${n.name} ?`)){const e=await E.deleteInventory({uuid:n.uuid});e.status==="success"?(D.refetchQueries("inventories"),v(e.message,"green","top")):v("There was an error","red","top-right")}},ie=()=>{J.products.length===0?v("You need to create at least one PRODUCT in order to create inventories!","orange","top"):(V.value="Create Inventory",w.value=!0,N.value=!1)},de=n=>{i.value=n.quantity,d.value=n.buying_price,V.value=`Update Actual Quantity for  ${n.product}`,F.value=n,C.value=!0},ce=async()=>{_.value=!0,k.value="";const n={product_uuid:s.product_id.uuid,measurement_name:s.product_id.measurement,quantity:i.value,buying_price:d.value};if(n.product_uuid&&n.measurement_name&&n.quantity&&n.buying_price){const a=await E.createInventory(n);a.status==="success"?(D.refetchQueries("inventories"),D.refetchQueries("finished_products"),s.product_id="",s.measurement_id="",i.value=1,s.buying_price=1,w.value=!1,_.value=!1,v(a.message,"green","top")):(k.value=a.message,v(a.message,"red","top-right"))}else _.value=!1,k.value="Product, Quantity and Buying Price are required!",v("Product, Quantity and Buying Price are required!","red","top-right")},H=async()=>{_.value=!0;const n={quantity:Number(i.value),buying_price:Number(d.value),inventory_uuid:F.value.uuid};if(n.quantity&&n.buying_price){const a=await E.updateInventory(n);a.status==="success"?(D.refetchQueries("inventories"),i.value=1,d.value=1,w.value=!1,C.value=!1,N.value=!1,V.value="",_.value=!1,v(a.message,"green","top")):v("There was an error","red","top-right")}else _.value=!1,k.value="Quantity and Buying price are required!",v("Quantity and Buying price are required!","red","top-right")},K=()=>{w.value=!1,C.value=!1,s.product_id="",i.value=1,d.value=1,F.value="",k.value=""},v=(n,a,e)=>{O.notify({message:n,color:a,position:e})},me=n=>{const a=n.map(e=>({name:e.name,inventories:e.inventories.length,created_at:e.created_at}));we(a,re,Ie,O,"InventoriesData")};return(n,a)=>(y(),L("div",Ue,[m(oe)?(y(),L("div",Se,"Loading inventories...")):m(Y)?(y(),L("div",Te,"An error has occurred: "+r(m(Y)),1)):(y(),x(Qe,{key:2,title:"Purchases/Inventories",rows:m(R),columns:m(re),separator:"cell","row-key":"name",filter:z.value,dense:""},{body:l(e=>[t(ve,{props:e},{default:l(()=>{var h,q,P;return[t(f,{key:"product",props:e},{default:l(()=>[u(r(e.row.product),1)]),_:2},1032,["props"]),t(f,{key:"buying_price",props:e},{default:l(()=>[u(r(e.row.buying_price),1)]),_:2},1032,["props"]),t(f,{key:"quantity",props:e},{default:l(()=>[u(r(e.row.quantity),1)]),_:2},1032,["props"]),t(f,{key:"total",props:e},{default:l(()=>[u(r(e.row.total),1)]),_:2},1032,["props"]),t(f,{key:"measurement",props:e},{default:l(()=>[u(r(e.row.measurement),1)]),_:2},1032,["props"]),t(f,{key:"department",props:e},{default:l(()=>[u(r(e.row.department),1)]),_:2},1032,["props"]),t(f,{key:"user",props:e},{default:l(()=>[u(r(e.row.user),1)]),_:2},1032,["props"]),t(f,{key:"created_at",props:e},{default:l(()=>[u(r(e.row.created_at),1)]),_:2},1032,["props"]),m(ne)((P=(q=(h=m(Q))==null?void 0:h.user)==null?void 0:q.user)==null?void 0:P.roles)?(y(),x(f,{key:"actions",props:e},{default:l(()=>[t(j,{color:"blue",name:"edit",onClick:pe=>de(e.row),style:{cursor:"pointer"},size:"20px",class:"q-mr-md"},null,8,["onClick"]),t(j,{color:"red",name:"delete",onClick:pe=>se(e.row),style:{cursor:"pointer"},size:"20px"},null,8,["onClick"])]),_:2},1032,["props"])):B("",!0)]}),_:2},1032,["props"])]),"top-right":l(()=>{var e,h,q;return[t(U,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:z.value,"onUpdate:modelValue":a[0]||(a[0]=P=>z.value=P),placeholder:"Search",class:"q-mr-md"},{append:l(()=>[t(j,{name:"search"})]),_:1},8,["modelValue"]),m(ne)((q=(h=(e=m(Q))==null?void 0:e.user)==null?void 0:h.user)==null?void 0:q.roles)?(y(),x(be,{key:0},{default:l(()=>[t(g,{onClick:ie,dense:"",color:"primary",icon:"add",label:"Add"}),t(g,{dense:"",flat:"",color:"primary","icon-right":"archive",label:"Export",class:"q-ml-sm","no-caps":"",onClick:a[1]||(a[1]=P=>me(m(R)))})]),_:1})):B("",!0)]}),_:1},8,["rows","columns","filter"])),t(Z,{modelValue:C.value,"onUpdate:modelValue":a[4]||(a[4]=e=>C.value=e),persistent:""},{default:l(()=>[t(X,{style:{width:"500px"}},{default:l(()=>[t(W,null,{default:l(()=>[u(r(V.value)+" ",1),t(S),p("small",null,[t(T,null,{default:l(()=>[u("Total: "+r(i.value*d.value),1)]),_:1})])]),_:1}),t(A,null,{default:l(()=>[t(U,{dense:"",outlined:"",modelValue:i.value,"onUpdate:modelValue":a[2]||(a[2]=e=>i.value=e),label:"Actual Quantity",type:"number"},null,8,["modelValue"])]),_:1}),t(A,null,{default:l(()=>[t(U,{dense:"",outlined:"",modelValue:d.value,"onUpdate:modelValue":a[3]||(a[3]=e=>d.value=e),label:"Buying Price",type:"number"},null,8,["modelValue"])]),_:1}),p("div",Ae,[p("small",null,r(k.value),1)]),t(ee,{align:"right"},{default:l(()=>[t(g,{flat:"",label:"Cancel",color:"red",onClick:K}),t(S),t(g,{flat:"",label:"Edit Inventory",color:"primary",onClick:H})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Z,{modelValue:w.value,"onUpdate:modelValue":a[8]||(a[8]=e=>w.value=e),persistent:""},{default:l(()=>[t(X,{style:{width:"600px"}},{default:l(()=>[t(W,null,{default:l(()=>[p("div",De,r(V.value),1),t(S),p("small",null,[p("i",null,"Total: "+r(i.value*d.value),1)]),t(S),s.product_id?(y(),L("small",Ee,[t(T,{class:"q-mr-sm"},{default:l(()=>[u("Measurement: "+r(s.product_id.measurement),1)]),_:1}),t(T,null,{default:l(()=>[u("Available Quantity: "+r(s.product_id.quantity),1)]),_:1}),Ne,t(T,null,{default:l(()=>[u("Previous Buying Price: "+r(s.product_id.buying_price),1)]),_:1})])):B("",!0)]),_:1}),t(A,null,{default:l(()=>[t(ke,{outlined:"",clearable:"",dense:"",modelValue:s.product_id,"onUpdate:modelValue":a[5]||(a[5]=e=>s.product_id=e),"use-input":"","input-debounce":"0",label:"Select Product",options:M.value,"option-value":"uuid","option-label":"name",onFilter:ue,behavior:"menu",hint:"Type in product name to filter..."},{option:l(e=>[t(te,ge({dense:""},e.itemProps),{default:l(()=>[t(ae,null,{default:l(()=>[t(he,null,{default:l(()=>[u(r(e.opt.name)+" : ",1),p("small",null,[t(T,{color:"orange"},{default:l(()=>[u("Available Qty: "+r(e.opt.quantity),1)]),_:2},1024)])]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":l(()=>[t(te,null,{default:l(()=>[t(ae,{class:"text-grey"},{default:l(()=>[t(g,{size:"sm",outline:"",label:"No results? CLick here to create new product.",to:"/products",color:"primary"})]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),_:1}),t(A,null,{default:l(()=>[t(U,{dense:"",outlined:"",modelValue:i.value,"onUpdate:modelValue":a[6]||(a[6]=e=>i.value=e),label:"Product Quantity",type:"number"},null,8,["modelValue"])]),_:1}),t(A,null,{default:l(()=>[t(U,{dense:"",outlined:"",modelValue:d.value,"onUpdate:modelValue":a[7]||(a[7]=e=>d.value=e),label:"Buying Price (Per Unit)",type:"number"},null,8,["modelValue"])]),_:1}),p("div",$e,[p("small",null,r(k.value),1)]),t(ee,{align:"right"},{default:l(()=>[t(g,{flat:"",label:"Cancel",color:"red",onClick:K}),t(S),s.product_id&&!N.value?(y(),x(g,{key:0,flat:"",label:"Add Inventory",color:"primary",onClick:ce,loading:_.value},null,8,["loading"])):B("",!0),s.product_id&&N.value?(y(),x(g,{key:1,flat:"",label:"Edit Inventory",color:"primary",onClick:H,loading:_.value},null,8,["loading"])):B("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{tt as default};
