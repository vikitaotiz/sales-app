import{cp as Te,c1 as Be,r as s,j as se,aJ as f,a6 as N,d as t,bb as n,u as _,Q as o,a4 as V,bE as p,ad as r,a5 as Q,bD as O,a7 as c,ax as Se,bd as z,bw as ie}from"./index.04598a5c.js";import{Q as Ue,c as C,d as $e}from"./QSpace.cae1b232.js";import{Q as ee}from"./QBtnGroup.403d6b8b.js";import{a as te,Q as Y}from"./QToolbar.9ff41b89.js";import{Q as j,b as D}from"./QCard.ceedae79.js";import{Q as k,a as Me}from"./QTr.dab6a52c.js";import{Q as F}from"./QInput.7f992565.js";import{l as ae,k as de,i as Ae}from"./rtl.8a61e29b.js";import{g as Ee,p as G,Q as ce,a as me}from"./module_calls.946e5d72.js";import{Q as pe}from"./QSeparator.60b941db.js";import{C as ve}from"./ClosePopup.f4132b96.js";import{e as Ne,a as Ye}from"./excel.5d19a2ad.js";import{a as Fe}from"./use-quasar.f2be70aa.js";import{a as Re,u as fe,b as Le}from"./index.6f673013.js";import{h as T}from"./moment.9709ab41.js";import{u as Oe}from"./product-store.29ac6317.js";import{u as ze}from"./auth-store.00b1fc28.js";import{h as ye}from"./helpers.6384b5cb.js";const _e=[{name:"product",required:!0,label:"Product",align:"left",field:u=>u.name,format:u=>`${u}`,sortable:!0},{name:"buying_price",align:"center",label:"Buying Price (Per Unit)",field:"buying_price",sortable:!0},{name:"quantity",align:"center",label:"Quantity",field:"quantity",sortable:!0},{name:"total",align:"center",label:"Total Cost",field:"total",sortable:!0},{name:"measurement",align:"center",label:"Measurement",field:"measurement",sortable:!0},{name:"department",align:"center",label:"Department",field:"department",sortable:!0},{name:"user",align:"center",label:"Created By",field:"user",sortable:!0},{name:"created_at",align:"center",label:"Created On",field:"created_at",sortable:!0},{name:"actions",align:"center",label:"Actions",field:"created_at"}],B=Te(),g=B==null?void 0:B.token,je=Be("inventories",{state:()=>({inventories:[]}),actions:{async fetchInventories(){if(g){const u=await Ee("inventories",g);return this.inventories=u==null?void 0:u.data,this.inventories}},async fetchInventoriesInDateRange(u){if(g)return await G(u,"get_older_inventories",g)},async createInventory(u){var h;if(u.user_uuid=(h=B==null?void 0:B.user)==null?void 0:h.uuid,g)return await G(u,"inventories",g)},async updateInventory(u){if(g)return await G(u,"update_inventory",g)},async deleteInventory(u){if(g)return await G(u,"delete_inventory",g)}}});const Ge={class:"q-pa-md"},Je={key:0},We={key:1},He={class:"text-center error_msg"},Ke={class:"text-h6"},Xe={key:0},Ze=c("br",null,null,-1),et={class:"text-center error_msg"},tt={class:"text-center q-ma-sm"},at=["max"],nt=c("br",null,null,-1),lt={key:0},ot=["max"],Ct={__name:"Inventories",setup(u){const h=ze(),S=Fe(),U=Re(),$=je(),ne=Oe(),J=s(!1),x=s(!1),w=s(!1),M=s(!1),R=s(!1),W=s(""),A=s(""),v=s(1),y=s(1),m=se({product_id:"",measurement_id:""}),H=s(""),I=s("");let L=[];const K=s("Today"),ge=s("2019/03/01"),be=s("2019/03/01"),le=new Date().toISOString().split("T")[0],i=se({from:"",to:""}),ke=()=>X.value=!0,X=s(!1),P=s([]),{isLoading:he,isError:oe}=fe("inventories",()=>$.fetchInventories(),{onSuccess:l=>{P.value=[],l==null||l.forEach(a=>{const e={product:a.product,buying_price:a.buying_price,quantity:a.quantity,total:a.total,measurement:a.measurement,department:a.department,user:a.user,created_at:a.created_at};P.value.push(e)})}});fe("products",()=>ne.fetchProducts(),{onSuccess:l=>{L=l.map(a=>({name:a.name,uuid:a.uuid,quantity:a.quantity,measurement:a.measurement,buying_price:a.buying_price}))}});const Z=s(L),we=(l,a)=>{if(l===""){a(()=>{Z.value=L});return}a(()=>{const e=l.toLowerCase();Z.value=L.filter(d=>d.name.toLowerCase().indexOf(e)>-1)})},Qe=async l=>{if(confirm(`Continue with the operation. Delete ${l.name} ?`)){const e=await $.deleteInventory({uuid:l.uuid});e.status==="success"?(U.refetchQueries("inventories"),b(e.message,"green","top")):b("There was an error","red","top-right")}},Ce=()=>{ne.products.length===0?b("You need to create at least one PRODUCT in order to create inventories!","orange","top"):(A.value="Create Inventory",x.value=!0,R.value=!1)},Ie=l=>{v.value=l.quantity,y.value=l.buying_price,A.value=`Update Actual Quantity for  ${l.product}`,H.value=l,M.value=!0},qe=async()=>{w.value=!0,I.value="";const l={product_uuid:m.product_id.uuid,measurement_name:m.product_id.measurement,quantity:v.value,buying_price:y.value};if(l.product_uuid&&l.measurement_name&&l.quantity&&l.buying_price){const a=await $.createInventory(l);a.status==="success"?(U.refetchQueries("inventories"),U.refetchQueries("finished_products"),m.product_id="",m.measurement_id="",v.value=1,m.buying_price=1,x.value=!1,w.value=!1,b(a.message,"green","top")):(I.value=a.message,b(a.message,"red","top-right"))}else w.value=!1,I.value="Product, Quantity and Buying Price are required!",b("Product, Quantity and Buying Price are required!","red","top-right")},re=async()=>{w.value=!0;const l={quantity:Number(v.value),buying_price:Number(y.value),inventory_uuid:H.value.uuid};if(l.quantity&&l.buying_price){const a=await $.updateInventory(l);a.status==="success"?(U.refetchQueries("inventories"),v.value=1,y.value=1,x.value=!1,M.value=!1,R.value=!1,A.value="",w.value=!1,b(a.message,"green","top")):b("There was an error","red","top-right")}else w.value=!1,I.value="Quantity and Buying price are required!",b("Quantity and Buying price are required!","red","top-right")},Ve=()=>{ge.value=be.value;let l=T(i.from),a=T(i.to),e={};parseInt(l.diff(a,"seconds"))>=0?(e.from=i.from,e.to=i.to):(e.from=i.to,e.to=i.from),xe(e),S.loading.show({message:`Please Wait. Fetching data between ${T(i.from).format("DD-MM-YY")} - ${T(i.to).format("DD-MM-YY")}`,boxClass:"bg-indigo text-white",spinnerColor:"white"})},{mutate:xe}=Le(l=>$.fetchInventoriesInDateRange(l),{onSuccess:l=>{var a,e;K.value=`(From: ${T(i.from).format("DD-MM-YY")} - To: ${T(i.to).format("DD-MM-YY")}). ${(a=l==null?void 0:l.data)==null?void 0:a.length} Records.`,S.loading.hide(),J.value=!0,P.value=[],(e=l==null?void 0:l.data)==null||e.forEach(d=>{const q={product:d.product,buying_price:d.buying_price,quantity:d.quantity,total:d.total,measurement:d.measurement,department:d.department,user:d.user,created_at:d.created_at};P.value.push(q)})}}),ue=()=>{x.value=!1,M.value=!1,m.product_id="",v.value=1,y.value=1,H.value="",I.value=""},b=(l,a,e)=>{S.notify({message:l,color:a,position:e})},Pe=l=>{const a=l.map(e=>({name:e.name,inventories:e.inventories.length,created_at:e.created_at}));Ne(a,_e,Ye,S,"InventoriesData")};return(l,a)=>(f(),N("div",Ge,[t(j,{dark:"",class:"bg-info q-mb-sm"},{default:n(()=>[t(te,null,{default:n(()=>[t(p,{dense:"",flat:"",icon:"arrow_back",label:"Back",onClick:a[0]||(a[0]=e=>l.$router.back())}),t(C),r(o(K.value),1),t(C),t(ee,null,{default:n(()=>[J.value?(f(),V(p,{key:0,icon:"autorenew",size:"sm",color:"orange",label:"Reset",onClick:a[1]||(a[1]=()=>{K.value="Today",_(U).refetchQueries("inventories"),J.value=!1})})):Q("",!0),t(p,{icon:"event",size:"sm",color:"indigo",label:"Calendar (Older Inventories)",onClick:a[2]||(a[2]=e=>ke())})]),_:1})]),_:1})]),_:1}),_(he)?(f(),N("div",Je,"Loading inventories...")):_(oe)?(f(),N("div",We,"An error has occurred: "+o(_(oe)),1)):(f(),V(Ue,{key:2,title:"Purchases/Inventories",rows:P.value,columns:_(_e),separator:"cell","row-key":"name",filter:W.value,dense:""},{body:n(e=>[t(Me,{props:e},{default:n(()=>{var d,q,E;return[t(k,{key:"product",props:e},{default:n(()=>[r(o(e.row.product),1)]),_:2},1032,["props"]),t(k,{key:"buying_price",props:e},{default:n(()=>[r(o(e.row.buying_price),1)]),_:2},1032,["props"]),t(k,{key:"quantity",props:e},{default:n(()=>[r(o(e.row.quantity),1)]),_:2},1032,["props"]),t(k,{key:"total",props:e},{default:n(()=>[r(o(e.row.total),1)]),_:2},1032,["props"]),t(k,{key:"measurement",props:e},{default:n(()=>[r(o(e.row.measurement),1)]),_:2},1032,["props"]),t(k,{key:"department",props:e},{default:n(()=>[r(o(e.row.department),1)]),_:2},1032,["props"]),t(k,{key:"user",props:e},{default:n(()=>[r(o(e.row.user),1)]),_:2},1032,["props"]),t(k,{key:"created_at",props:e},{default:n(()=>[r(o(e.row.created_at),1)]),_:2},1032,["props"]),_(ye)((E=(q=(d=_(h))==null?void 0:d.user)==null?void 0:q.user)==null?void 0:E.roles)?(f(),V(k,{key:"actions",props:e},{default:n(()=>[t(O,{color:"blue",name:"edit",onClick:De=>Ie(e.row),style:{cursor:"pointer"},size:"20px",class:"q-mr-md"},null,8,["onClick"]),t(O,{color:"red",name:"delete",onClick:De=>Qe(e.row),style:{cursor:"pointer"},size:"20px"},null,8,["onClick"])]),_:2},1032,["props"])):Q("",!0)]}),_:2},1032,["props"])]),"top-right":n(()=>{var e,d,q;return[t(F,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:W.value,"onUpdate:modelValue":a[3]||(a[3]=E=>W.value=E),placeholder:"Search",class:"q-mr-md"},{append:n(()=>[t(O,{name:"search"})]),_:1},8,["modelValue"]),_(ye)((q=(d=(e=_(h))==null?void 0:e.user)==null?void 0:d.user)==null?void 0:q.roles)?(f(),V(ee,{key:0},{default:n(()=>[t(p,{onClick:Ce,dense:"",color:"primary",icon:"add",label:"Add"}),t(p,{dense:"",flat:"",color:"primary","icon-right":"archive",label:"Export",class:"q-ml-sm","no-caps":"",onClick:a[4]||(a[4]=E=>Pe(P.value))})]),_:1})):Q("",!0)]}),_:1},8,["rows","columns","filter"])),t(ae,{modelValue:M.value,"onUpdate:modelValue":a[7]||(a[7]=e=>M.value=e),persistent:""},{default:n(()=>[t(j,{style:{width:"500px"}},{default:n(()=>[t(te,null,{default:n(()=>[r(o(A.value)+" ",1),t(C),c("small",null,[t(Y,null,{default:n(()=>[r("Total: "+o(v.value*y.value),1)]),_:1})])]),_:1}),t(D,null,{default:n(()=>[t(F,{dense:"",outlined:"",modelValue:v.value,"onUpdate:modelValue":a[5]||(a[5]=e=>v.value=e),label:"Actual Quantity",type:"number",min:"1",oninput:"validity.valid||(value='');"},null,8,["modelValue"])]),_:1}),t(D,null,{default:n(()=>[t(F,{dense:"",outlined:"",modelValue:y.value,"onUpdate:modelValue":a[6]||(a[6]=e=>y.value=e),label:"Buying Price",type:"number",min:"1",oninput:"validity.valid||(value='');"},null,8,["modelValue"])]),_:1}),c("div",He,[c("small",null,o(I.value),1)]),t(de,{align:"right"},{default:n(()=>[t(p,{flat:"",label:"Cancel",color:"red",onClick:ue}),t(C),t(p,{flat:"",label:"Edit Inventory",color:"primary",onClick:re})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ae,{modelValue:x.value,"onUpdate:modelValue":a[11]||(a[11]=e=>x.value=e),persistent:""},{default:n(()=>[t(j,{style:{width:"600px"}},{default:n(()=>[t(te,null,{default:n(()=>[c("div",Ke,o(A.value),1),t(C),c("small",null,[c("i",null,"Total: "+o(v.value*y.value),1)]),t(C),m.product_id?(f(),N("small",Xe,[t(Y,{class:"q-mr-sm"},{default:n(()=>[r("Measurement: "+o(m.product_id.measurement),1)]),_:1}),t(Y,null,{default:n(()=>[r("Available Quantity: "+o(m.product_id.quantity),1)]),_:1}),Ze,t(Y,null,{default:n(()=>[r("Previous Buying Price: "+o(m.product_id.buying_price),1)]),_:1})])):Q("",!0)]),_:1}),t(D,null,{default:n(()=>[t($e,{outlined:"",clearable:"",dense:"",modelValue:m.product_id,"onUpdate:modelValue":a[8]||(a[8]=e=>m.product_id=e),"use-input":"","input-debounce":"0",label:"Select Product",options:Z.value,"option-value":"uuid","option-label":"name",onFilter:we,behavior:"menu",hint:"Type in product name to filter..."},{option:n(e=>[t(ce,Se({dense:""},e.itemProps),{default:n(()=>[t(me,null,{default:n(()=>[t(Ae,null,{default:n(()=>[r(o(e.opt.name)+" : ",1),c("small",null,[t(Y,{color:"orange"},{default:n(()=>[r("Available Qty: "+o(e.opt.quantity),1)]),_:2},1024)])]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":n(()=>[t(ce,null,{default:n(()=>[t(me,{class:"text-grey"},{default:n(()=>[t(p,{size:"sm",outline:"",label:"No results? CLick here to create new product.",to:"/products",color:"primary"})]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),_:1}),t(D,null,{default:n(()=>[t(F,{dense:"",outlined:"",modelValue:v.value,"onUpdate:modelValue":a[9]||(a[9]=e=>v.value=e),label:"Product Quantity",type:"number",min:"1",oninput:"validity.valid||(value='');"},null,8,["modelValue"])]),_:1}),t(D,null,{default:n(()=>[t(F,{dense:"",outlined:"",modelValue:y.value,"onUpdate:modelValue":a[10]||(a[10]=e=>y.value=e),label:"Buying Price (Per Unit)",type:"number",min:"1",oninput:"validity.valid||(value='');"},null,8,["modelValue"])]),_:1}),c("div",et,[c("small",null,o(I.value),1)]),t(de,{align:"right"},{default:n(()=>[t(p,{flat:"",label:"Cancel",color:"red",onClick:ue}),t(C),m.product_id&&!R.value?(f(),V(p,{key:0,flat:"",label:"Add Inventory",color:"primary",onClick:qe,loading:w.value},null,8,["loading"])):Q("",!0),m.product_id&&R.value?(f(),V(p,{key:1,flat:"",label:"Edit Inventory",color:"primary",onClick:re,loading:w.value},null,8,["loading"])):Q("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ae,{modelValue:X.value,"onUpdate:modelValue":a[14]||(a[14]=e=>X.value=e),persistent:""},{default:n(()=>[t(j,{class:"bg-indigo text-white text-center q-pa-sm",style:{width:"300px"}},{default:n(()=>[c("div",tt,[c("b",null,[t(O,{name:"events"}),r(" Date Picker")])]),t(pe,{color:"white"}),t(D,null,{default:n(()=>[c("div",null,[r(" From : "),z(c("input",{type:"date","onUpdate:modelValue":a[12]||(a[12]=e=>i.from=e),max:_(le)},null,8,at),[[ie,i.from]])]),nt,i.from?(f(),N("div",lt,[r(" To : "),z(c("input",{type:"date","onUpdate:modelValue":a[13]||(a[13]=e=>i.to=e),max:_(le)},null,8,ot),[[ie,i.to]])])):Q("",!0)]),_:1}),t(pe,{color:"yellow"}),t(ee,{flat:"",class:"full-width"},{default:n(()=>[z(t(p,{dense:"",label:"Cancel",color:"yellow",flat:""},null,512),[[ve]]),t(C),i.to?z((f(),V(p,{key:0,dense:"",label:"Fetch Inventories",color:"white",flat:"",onClick:Ve},null,512)),[[ve]]):Q("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Ct as default};
