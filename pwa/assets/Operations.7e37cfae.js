import{c5 as de,r as d,c as ce,aI as p,a5 as C,a6 as o,P as u,u as g,a3 as q,bb as a,b as me,d as e,a4 as V,bD as Q,ac as r,F as pe,aO as _e,bE as f,M as ve}from"./index.248bff09.js";import{Q as O}from"./QBadge.00574bee.js";import{a as B,Q as A}from"./QCard.863ff589.js";import{Q as U}from"./QInput.bd7f851f.js";import{Q as fe,a as z,p as ye,c as M,d as N,b as be}from"./paginations.fae28654.js";import{p as H,n as I,o as n}from"./rtl.ecb27788.js";import{Q as ge}from"./QSeparator.fc34b7a9.js";import{Q as he}from"./QBtnGroup.d2562c19.js";import{Q as F}from"./QToolbar.34f0bbd6.js";import{a as qe}from"./use-quasar.f0e5aaaf.js";import{u as R}from"./index.ff4c0bc9.js";import{p as Qe}from"./product_columns.33f8ffe3.js";import{u as ke}from"./product-store.49bca16a.js";import{u as Se}from"./payment-mode-store.5c8ccbed.js";import{u as xe}from"./sale-store.4321e753.js";import{p as we}from"./print.15699711.js";import"./use-dark.cfee1f79.js";import"./module_calls.421761b7.js";import"./helpers.73a7253f.js";import"./_commonjsHelpers.6150b38b.js";const Pe={class:"q-pa-md"},Ce={class:"row",style:{overflow:"hidden"}},Ve={class:"q-pa-xs col-xs-12 col-sm-6 col-md-7",style:{overflow:"auto"}},Ne={style:{color:"red"}},Be={key:0},Ae={key:1},$e=["onClick"],De={style:{color:"#017951"}},Ee=o("hr",null,null,-1),Ue=o("hr",null,null,-1),Me=o("br",null,null,-1),Ie=o("br",null,null,-1),Le=o("br",null,null,-1),Te={key:0,class:"q-pa-xs col-xs-12 col-sm-6 col-md-5",style:{overflow:"auto"}},Oe={style:{color:"orange"}},ze=o("br",null,null,-1),He=o("br",null,null,-1),Fe=o("hr",null,null,-1),Re={class:"text-h6"},je={class:"text-center error_msg"},Ge=o("div",{class:"text-h6"},"Make Payment",-1),Ke={class:"q-mt-sm"},Ye={class:"text-center error_msg"},yl={__name:"Operations",setup(Je){const j=de(),G=qe(),K=ke(),Y=Se(),L=xe(),$=ye(10),k=d(!1),S=d(!1),x=d(!0),D=d(""),c=d(1),h=d(1),w=d(""),J=d(""),_=d(""),E=d(""),m=d(""),i=d([]),{data:W,isLoading:X,isError:T}=R("products",()=>K.fetchProducts()),{data:Z}=R("payment_modes",()=>Y.fetchPaymentModes()),ee=s=>{_.value="",E.value="",i.value.some(t=>t.name==s.name)?(_.value="Product already added to the bill! Select a different product.",E.value="Product already added to the bill! Select a different product.",y(`${s.name} already added to the bill!`,"red","top")):(S.value=!0,m.value=s)},le=()=>{k.value=!0},ae=()=>{S.value=!1,m.value="",c.value=1},te=()=>{if(c.value>m.value.quantity)_.value=`${c.value} is more than the maximum available quantity`,y(`${c.value} is more than the maximum available quantity`,"red","top");else{const s={uuid:m.value.uuid,name:m.value.name,price:m.value.selling_price,quantity:c.value};i.value.push(s),y(`${m.value.name} added to cart!`,"green","top"),S.value=!1,m.value="",c.value=1}},P=ce(()=>{let s=0;return i.value.forEach(t=>{s+=t.quantity*t.price}),s}),oe=s=>i.value.splice(s,1),se=()=>{confirm("Are you sure?")&&(i.value=[])},ue=async()=>{let s=[];i.value.forEach(l=>s.push({name:l.name,quantity:l.quantity,uuid:l.uuid}));const t={products:s,payment_mode_uuid:w.value.uuid,bill_status:"sold"};if(x.value?(t.selling_price=Number(P.value),t.actual_selling_price=Number(P.value)):(t.selling_price=Number(P.value),t.actual_selling_price=Number(h.value)),t.selling_price&&t.payment_mode_uuid){const l=await L.createSaleOperation(t);console.log(l)}else _.value="Name is required!",y("Name is required!","red","top-right")},re=async()=>{var l;let s=[];if(confirm("Are you sure?")){i.value.forEach(v=>s.push({name:v.name,quantity:v.quantity,uuid:v.uuid}));const b={products:s};if((l=b==null?void 0:b.products)!=null&&l.length){const v=await L.createHoldBillOperation(b);v.status==="success"?(w.value="",c.value="",k.value=!1,i.value=[],j.push("/bills"),y(v.message,"green","top")):(_.value=v.message,y(v.message,"red","top-right"))}else _.value="Name is required!",y("Name is required!","red","top-right")}},ne=()=>{k.value=!1,c.value="",J.value="",_.value=""},y=(s,t,l)=>{G.notify({message:s,color:t,position:l})},ie=()=>{we({printable:i.value,properties:["name","quantity"],type:"json",gridHeaderStyle:"color: red;  border: 2px solid #3971A5;",gridStyle:"border: 2px solid #3971A5;"})};return(s,t)=>(p(),C("div",Pe,[o("div",Ce,[o("div",Ve,[o("small",Ne,u(E.value),1),g(X)?(p(),C("div",Be,"Loading products...")):g(T)?(p(),C("div",Ae,"An error has occurred: "+u(g(T)),1)):(p(),q(fe,{key:2,title:"Make Sale (All Products)",rows:g(W),columns:g(Qe),pagination:g($),"onUpdate:pagination":t[1]||(t[1]=l=>me($)?$.value=l:null),separator:"cell","row-key":"name",filter:D.value,dense:"",grid:""},{item:a(l=>[o("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4",onClick:b=>ee(l.row)},[e(B,{bordered:"",class:"selected_product"},{default:a(()=>[e(A,{class:"text-center"},{default:a(()=>[o("strong",De,[e(Q,{name:"bubble_chart"}),r(" "+u(l.row.name),1)]),Ee,o("small",null,[o("i",null,[r("Selling Price: "),o("b",null,"Ksh "+u(l.row.selling_price),1)])]),Ue,o("small",null,[o("i",null,"Category: "+u(l.row.category),1)]),Me,o("small",null,[o("i",null,"Department: "+u(l.row.department),1)]),Ie,o("small",null,[e(O,{color:"orange"},{default:a(()=>[r("Available Quantity "),Le,r(u(l.row.quantity)+" "+u(l.row.measurement),1)]),_:2},1024)])]),_:2},1024)]),_:2},1024)],8,$e)]),"top-right":a(()=>[e(U,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:D.value,"onUpdate:modelValue":t[0]||(t[0]=l=>D.value=l),placeholder:"Search product...",class:"q-mr-md"},{append:a(()=>[e(Q,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","pagination","filter"]))]),i.value.length>0?(p(),C("div",Te,[e(B,{bordered:""},{default:a(()=>[e(M,null,{default:a(()=>[o("i",null,[e(Q,{name:"shopping_cart"}),r(" New Bill")]),r(),e(N),o("span",Oe,"(Items: "+u(i.value.length)+")",1)]),_:1}),e(A,null,{default:a(()=>[e(H,{bordered:"",separator:"",dense:"",class:"bill"},{default:a(()=>[e(I,null,{default:a(()=>[e(n,null,{default:a(()=>[r("Name")]),_:1}),e(n,{style:{color:"white"}},{default:a(()=>[r("Price")]),_:1}),e(n,{style:{color:"white"}},{default:a(()=>[r("Quantity")]),_:1}),e(n,{side:"",style:{color:"white"}},{default:a(()=>[r("Total")]),_:1}),e(n,{avatar:""},{default:a(()=>[e(Q,{class:"select_list",name:"delete",dense:"",color:"white",onClick:se})]),_:1})]),_:1})]),_:1}),ze,e(H,{bordered:"",separator:"",dense:""},{default:a(()=>[(p(!0),C(pe,null,_e(i.value,(l,b)=>(p(),q(I,{key:l.uuid},{default:a(()=>[e(n,null,{default:a(()=>[r(u(l.name),1)]),_:2},1024),e(n,null,{default:a(()=>[r(u(l.price),1)]),_:2},1024),e(n,null,{default:a(()=>[r(u(l.quantity),1)]),_:2},1024),e(n,{side:""},{default:a(()=>[r(u(l.price*l.quantity),1)]),_:2},1024),e(n,{avatar:""},{default:a(()=>[e(Q,{class:"select_list",name:"delete",dense:"",color:"red",onClick:v=>oe(b)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(ge,{color:"orange"}),e(I,null,{default:a(()=>[e(n,null,{default:a(()=>[r("Total")]),_:1}),e(n,{avatar:""},{default:a(()=>[r(u(P.value),1)]),_:1}),e(n,{avatar:""})]),_:1})]),_:1}),He,e(he,{spread:"",rounded:""},{default:a(()=>[e(f,{size:"sm",color:"primary",label:"Sale",icon:"grain",onClick:le}),e(f,{size:"sm",color:"orange",label:"Hold Bill",icon:"pan_tool",onClick:re})]),_:1}),Fe,e(f,{color:"primary",flat:"",class:"full-width",label:"Print Bill",icon:"print",onClick:ie})]),_:1})]),_:1})])):V("",!0)]),e(z,{modelValue:S.value,"onUpdate:modelValue":t[3]||(t[3]=l=>S.value=l),persistent:""},{default:a(()=>[e(B,{style:{width:"500px"}},{default:a(()=>[e(F,null,{default:a(()=>[o("div",Re,[e(Q,{name:"bubble_chart"}),r(" "+u(m.value.name),1)]),e(N),o("small",null,[e(O,null,{default:a(()=>[r(u(m.value.measurement),1)]),_:1})])]),_:1}),e(A,{class:"q-pt-none"},{default:a(()=>[e(U,{autofocus:"",outlined:"",dense:"",label:"Product Quantity",modelValue:c.value,"onUpdate:modelValue":t[2]||(t[2]=l=>c.value=l),type:"number",hint:`Note : You can sale a maximum of ${m.value.quantity}`},null,8,["modelValue","hint"])]),_:1}),o("div",je,[o("small",null,u(_.value),1)]),e(M,{align:"right"},{default:a(()=>[e(f,{flat:"",label:"Cancel",color:"red",onClick:ae}),e(N),c.value?(p(),q(f,{key:0,flat:"",label:"Add Product",color:"primary",onClick:te})):V("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(z,{modelValue:k.value,"onUpdate:modelValue":t[7]||(t[7]=l=>k.value=l),persistent:""},{default:a(()=>[e(B,{style:{width:"500px"}},{default:a(()=>[e(F,null,{default:a(()=>[Ge,e(N),o("small",Ke,[e(f,{size:"sm",dense:"",color:"blue",depressed:"",class:ve(`${x.value?"":"actual_selling_price"}`),onClick:t[4]||(t[4]=l=>x.value=!x.value),label:`Expected Selling Price : ${P.value}`},null,8,["class","label"])])]),_:1}),e(A,{class:"q-pt-none"},{default:a(()=>[x.value?V("",!0):(p(),q(U,{key:0,autofocus:"",outlined:"",dense:"",label:"Actual Selling Price",modelValue:h.value,"onUpdate:modelValue":t[5]||(t[5]=l=>h.value=l),class:"q-pa-xs col-xs-12 col-sm-6 col-md-6 q-mb-sm",type:"number"},null,8,["modelValue"])),h.value&&h.value>0?(p(),q(be,{key:1,dense:"",outlined:"",modelValue:w.value,"onUpdate:modelValue":t[6]||(t[6]=l=>w.value=l),options:g(Z),"option-value":"uuid","option-label":"name",label:"Select Payment Mode"},null,8,["modelValue","options"])):V("",!0)]),_:1}),o("div",Ye,[o("small",null,u(_.value),1)]),e(M,{align:"right"},{default:a(()=>[e(f,{flat:"",label:"Cancel",color:"red",onClick:ne}),e(N),h.value&&w.value?(p(),q(f,{key:0,flat:"",label:"Sale",color:"primary",onClick:ue})):V("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{yl as default};
