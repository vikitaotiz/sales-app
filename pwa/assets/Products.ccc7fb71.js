import{Q as i,a as ve}from"./QTr.812082b5.js";import{Q as _e,a as fe}from"./QToolbar.816160ea.js";import{bA as ge,c as ae,h as M,bB as H,g as ye,r as u,aJ as n,a6 as K,u as r,Q as s,a4 as p,bb as o,d as l,ad as c,a7 as v,bD as W,a5 as U,bE as S}from"./index.fa4385c5.js";import{Q as N}from"./QInput.9694c633.js";import{Q as be}from"./QBtnGroup.a0b376e3.js";import{Q as ke,c as le,d as X}from"./QSpace.24bc44b2.js";import{u as qe,a as Qe,Q as Ve,b as j}from"./QCard.4da288be.js";import{o as we,n as he}from"./rtl.f6ac1500.js";import{e as Pe,a as Ce}from"./excel.5d19a2ad.js";import{a as Se}from"./use-quasar.0d0cec89.js";import{a as xe,u as G}from"./index.b8dd7cb3.js";import{p as oe}from"./product_columns.133b4496.js";import{u as Ae}from"./product-store.097a19da.js";import{u as Be}from"./category-store.9e19d55d.js";import{u as De}from"./measurement-store.bc67f2d9.js";import{u as Ee}from"./department-store.1fb0cb71.js";import{u as Ue}from"./auth-store.08242815.js";import{h as ue}from"./helpers.22d5b68c.js";import"./QSeparator.438186f9.js";import"./module_calls.606d4328.js";var Ne=ge({name:"QBanner",props:{...qe,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(g,{slots:y}){const{proxy:{$q:T}}=ye(),x=Qe(g,T),b=ae(()=>"q-banner row items-center"+(g.dense===!0?" q-banner--dense":"")+(x.value===!0?" q-banner--dark q-dark":"")+(g.rounded===!0?" rounded-borders":"")),$=ae(()=>`q-banner__actions row items-center justify-end col-${g.inlineActions===!0?"auto":"all"}`);return()=>{const I=[M("div",{class:"q-banner__avatar col-auto row items-center self-start"},H(y.avatar)),M("div",{class:"q-banner__content col text-body2"},H(y.default))],A=H(y.action);return A!==void 0&&I.push(M("div",{class:$.value},A)),M("div",{class:b.value+(g.inlineActions===!1&&A!==void 0?" q-banner--top-padding":""),role:"alert"},I)}}});const Te={class:"q-pa-md"},$e={key:0},Ie={key:1},ze={class:"text-h6"},Me=v("small",null,[v("b",null,"Quantity should be adjusted from inventories...")],-1),je={class:"row q-col-gutter-sm q-mb-sm q-pa-md"},Ge={class:"row q-col-gutter-sm q-mb-sm q-pa-md"},Le={class:"text-center error_msg"},it={__name:"Products",setup(g){const y=Ue(),T=Se(),x=xe(),b=Ae(),$=Be(),I=De(),A=Ee(),B=u(!1),k=u(!1),q=u(!1),L=u(""),z=u(""),Z=u(""),_=u(""),m=u(""),Q=u(1),V=u(1),w=u(1),{data:O,isLoading:re,isError:ee}=G("products",()=>b.fetchProducts()),h=u("");let R=u([]);const P=u("");let Y=u([]);const C=u("");let F=u([]);G("categories",()=>$.fetchCategories(),{onSuccess:a=>{Y.value=a.map(e=>({uuid:e.uuid,name:e.name}))}}),G("measurements",()=>I.fetchMeasurements(),{onSuccess:a=>{R.value=a.map(e=>({uuid:e.uuid,name:e.name}))}}),G("departments",()=>A.fetchDepartments(),{onSuccess:a=>{F.value=a.map(e=>({uuid:e.uuid,name:e.name}))}});const se=async a=>{if(confirm(`Continue with the operation. Delete ${a.name} ?`)){const t=await b.deleteProduct({uuid:a.uuid});t.status==="success"?(x.refetchQueries("products"),d(t.message,"green","top")):d("There was an error","red","top-right")}},ne=()=>{k.value=!1,$.categories.length===0?d("You need to create at least one CATEGORY in order to create products!","orange","top"):(z.value="Add New Product",B.value=!0)},de=a=>{k.value=!0,z.value=`Edit ${a.name}`,Z.value=a.uuid,B.value=!0,m.value=a.name,Q.value=a.quantity,V.value=a.buying_price,w.value=a.selling_price,h.value=R.value.find(e=>e.name===a.measurement),P.value=Y.value.find(e=>e.name===a.category),C.value=F.value.find(e=>e.name===a.department)},ie=async()=>{_.value="",q.value=!0;const a={name:m.value.trim(),quantity:Q.value,selling_price:w.value,buying_price:V.value,category_uuid:P.value.uuid,department_uuid:C.value.uuid,measurement_uuid:h.value.uuid};if(a.name&&a.quantity&&a.selling_price&&a.buying_price&&a.category_uuid&&a.department_uuid&&a.measurement_uuid){const e=await b.createProduct(a);e.status==="success"?(x.refetchQueries("products"),J(),d(e.message,"green","top")):(_.value=e.message,d(e.message,"red","top-right"))}else _.value="All fields are required!",q.value=!1,d("All fields are required!","red","top-right")},ce=async()=>{_.value="",q.value=!0;const a={product_uuid:Z.value,name:m.value.trim(),quantity:Q.value,selling_price:w.value,buying_price:V.value,category_uuid:P.value.uuid,department_uuid:C.value.uuid,measurement_uuid:h.value.uuid};if(a.name&&a.quantity&&a.selling_price&&a.buying_price&&a.category_uuid&&a.department_uuid&&a.measurement_uuid){const e=await b.updateProduct(a);e.status==="success"?(x.refetchQueries("products"),J(),d(e.message,"green","top")):d(e.message,"red","top-right")}else _.value="All fields are required!",d("All fields are required!","red","top-right")},me=()=>J(),d=(a,e,t)=>{T.notify({message:a,color:e,position:t})},J=()=>{m.value="",w.value=1,V.value=1,P.value="",C.value="",h.value="",Q.value=1,B.value=!1,q.value=!1,k.value=!1,z.value="",_.value=""},pe=a=>{const e=a.map(t=>({name:t.name,products:t.products.length,created_at:t.created_at}));Pe(e,oe,Ce,T,"ProductsData")};return(a,e)=>(n(),K("div",Te,[r(re)?(n(),K("div",$e,"Loading products...")):r(ee)?(n(),K("div",Ie,"An error has occurred: "+s(r(ee)),1)):(n(),p(ke,{key:2,title:"Products",rows:r(O),columns:r(oe),separator:"cell","row-key":"name",filter:L.value,dense:""},{body:o(t=>[l(ve,{props:t},{default:o(()=>{var D,E,f;return[l(i,{key:"name",props:t},{default:o(()=>[c(s(t.row.name),1)]),_:2},1032,["props"]),l(i,{key:"measurement",props:t},{default:o(()=>[c(s(t.row.measurement)+" ",1),v("small",null,[l(_e,null,{default:o(()=>[c(": "+s(t.row.quantity),1)]),_:2},1024)])]),_:2},1032,["props"]),l(i,{key:"buying_price",props:t},{default:o(()=>[c(s(t.row.buying_price),1)]),_:2},1032,["props"]),l(i,{key:"selling_price",props:t},{default:o(()=>[c(s(t.row.selling_price),1)]),_:2},1032,["props"]),l(i,{key:"department",props:t},{default:o(()=>[c(s(t.row.department),1)]),_:2},1032,["props"]),l(i,{key:"category",props:t},{default:o(()=>[c(s(t.row.category),1)]),_:2},1032,["props"]),l(i,{key:"user",props:t},{default:o(()=>[c(s(t.row.user),1)]),_:2},1032,["props"]),l(i,{key:"created_at",props:t},{default:o(()=>[c(s(t.row.created_at),1)]),_:2},1032,["props"]),r(ue)((f=(E=(D=r(y))==null?void 0:D.user)==null?void 0:E.user)==null?void 0:f.roles)?(n(),p(i,{key:"actions",props:t},{default:o(()=>[l(W,{color:"blue",name:"edit",onClick:te=>de(t.row),style:{cursor:"pointer"},size:"20px",class:"q-mr-md"},null,8,["onClick"]),l(W,{color:"red",name:"delete",onClick:te=>se(t.row),style:{cursor:"pointer"},size:"20px"},null,8,["onClick"])]),_:2},1032,["props"])):U("",!0)]}),_:2},1032,["props"])]),"top-right":o(()=>{var t,D,E;return[l(N,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:L.value,"onUpdate:modelValue":e[0]||(e[0]=f=>L.value=f),placeholder:"Search",class:"q-mr-md"},{append:o(()=>[l(W,{name:"search"})]),_:1},8,["modelValue"]),r(ue)((E=(D=(t=r(y))==null?void 0:t.user)==null?void 0:D.user)==null?void 0:E.roles)?(n(),p(be,{key:0},{default:o(()=>{var f;return[l(S,{onClick:ne,dense:"",color:"blue",size:"small",icon:"add",label:"Add"}),((f=r(O))==null?void 0:f.length)>0?(n(),p(S,{key:0,dense:"",flat:"",color:"primary","icon-right":"archive",label:"Export",class:"q-ml-sm","no-caps":"",onClick:e[1]||(e[1]=te=>pe(r(O)))})):U("",!0)]}),_:1})):U("",!0)]}),_:1},8,["rows","columns","filter"])),l(we,{modelValue:B.value,"onUpdate:modelValue":e[9]||(e[9]=t=>B.value=t),persistent:""},{default:o(()=>[l(Ve,{style:{width:"500px"}},{default:o(()=>[l(j,null,{default:o(()=>[v("div",ze,s(z.value),1)]),_:1}),l(j,{class:"q-pt-none"},{default:o(()=>[l(N,{outlined:"",dense:"",label:"Name",modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=t=>m.value=t)},null,8,["modelValue"])]),_:1}),l(j,{class:"q-pt-none"},{default:o(()=>[k.value?(n(),p(Ne,{key:1,class:"bg-primary text-white"},{default:o(()=>[l(fe,null,{default:o(()=>[Me,l(le),l(S,{label:"INVENTORIES",outline:"",size:"sm",to:"/inventories"})]),_:1})]),_:1})):(n(),p(N,{key:0,outlined:"",dense:"",label:"Initial Quantity",modelValue:Q.value,"onUpdate:modelValue":e[3]||(e[3]=t=>Q.value=t),type:"number"},null,8,["modelValue"]))]),_:1}),v("div",je,[l(N,{outlined:"",dense:"",label:"Buying Price (Per Unit)",modelValue:V.value,"onUpdate:modelValue":e[4]||(e[4]=t=>V.value=t),type:"number",class:"col-6"},null,8,["modelValue"]),l(N,{outlined:"",dense:"",label:"Selling Price (Per Unit)",modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=t=>w.value=t),type:"number",class:"col-6"},null,8,["modelValue"])]),v("div",Ge,[l(X,{dense:"",outlined:"",modelValue:P.value,"onUpdate:modelValue":e[6]||(e[6]=t=>P.value=t),options:r(Y),"option-value":"uuid","option-label":"name",label:"Select Product Category",class:"col-6"},null,8,["modelValue","options"]),l(X,{dense:"",outlined:"",modelValue:h.value,"onUpdate:modelValue":e[7]||(e[7]=t=>h.value=t),options:r(R),"option-value":"uuid","option-label":"name",label:"Select Product Measurement",class:"col-6"},null,8,["modelValue","options"])]),l(j,{class:"q-pt-none"},{default:o(()=>[l(X,{dense:"",outlined:"",modelValue:C.value,"onUpdate:modelValue":e[8]||(e[8]=t=>C.value=t),options:r(F),"option-value":"uuid","option-label":"name",label:"Select Product Department"},null,8,["modelValue","options"])]),_:1}),v("div",Le,[v("small",null,s(_.value),1)]),l(he,{align:"right"},{default:o(()=>[l(S,{flat:"",label:"Cancel",color:"red",onClick:me}),l(le),m.value&&!k.value?(n(),p(S,{key:0,flat:"",label:"Add Product",color:"primary",onClick:ie,loading:q.value},null,8,["loading"])):U("",!0),m.value&&k.value?(n(),p(S,{key:1,flat:"",label:"Edit Product",color:"primary",onClick:ce,loading:q.value},null,8,["loading"])):U("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{it as default};
