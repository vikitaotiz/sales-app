import{Q as s,a as ne}from"./QTr.0d9fa9cb.js";import{c9 as re,c8 as oe,r as _,j as le,aI as f,a5 as C,u as c,P as i,a3 as U,bb as n,b as ie,d as t,ac as u,bD as E,bE as v,a6 as k,a4 as S}from"./index.248bff09.js";import{Q as h}from"./QInput.bd7f851f.js";import{Q as ue}from"./QBtnGroup.d2562c19.js";import{Q as se,a as L,p as de,c as j,d as D,b as ce}from"./paginations.fae28654.js";import{Q as F}from"./QToolbar.34f0bbd6.js";import{a as G,Q as x}from"./QCard.863ff589.js";import{Q as O}from"./QBadge.00574bee.js";import{e as me,a as pe}from"./excel.5d19a2ad.js";import{a as ye}from"./use-quasar.f0e5aaaf.js";import{a as _e,u as R}from"./index.ff4c0bc9.js";import{g as fe,p as N}from"./module_calls.421761b7.js";import{u as ve}from"./product-store.49bca16a.js";import"./use-dark.cfee1f79.js";import"./QSeparator.fc34b7a9.js";import"./rtl.ecb27788.js";import"./helpers.73a7253f.js";const H=[{name:"product",required:!0,label:"Product",align:"left",field:l=>l.name,format:l=>`${l}`,sortable:!0},{name:"buying_price",align:"center",label:"Buying Price",field:"buying_price",sortable:!0},{name:"quantity",align:"center",label:"Quantity",field:"quantity",sortable:!0},{name:"actual_quantity",align:"center",label:"Actual Quantity",field:"quantity_quantity",sortable:!0},{name:"measurement",align:"center",label:"Measurement",field:"measurement",sortable:!0},{name:"department",align:"center",label:"Department",field:"department",sortable:!0},{name:"user",align:"center",label:"Created By",field:"user",sortable:!0},{name:"created_at",align:"center",label:"Created On",field:"created_at",sortable:!0},{name:"actions",align:"center",label:"Actions",field:"created_at"}],b=re(),m=b==null?void 0:b.token,ge=oe("inventories",{state:()=>({inventories:[]}),actions:{async fetchInventories(){if(m){const l=await fe("inventories",m);return this.inventories=l==null?void 0:l.data,this.inventories}},async createInventory(l){var p;if(l.user_uuid=(p=b==null?void 0:b.user)==null?void 0:p.uuid,m)return await N(l,"inventories",m)},async updateInventory(l){if(m)return await N(l,"update_inventory",m)},async deleteInventory(l){if(m)return await N(l,"delete_inventory",m)}}});const be={class:"q-pa-md"},qe={key:0},Qe={key:1},ke={class:"text-center error_msg"},we={class:"text-h6"},Ie={key:0},Ve={class:"text-center error_msg"},Fe={__name:"Inventories",setup(l){const p=ye(),w=_e(),I=ge(),J=ve(),B=de(10),g=_(!1),q=_(!1),V=_(!1),P=_(""),Q=_(""),r=le({product_id:"",measurement_id:"",quantity:1,actual_quantity:1,buying_price:1}),A=_(""),y=_(""),{data:T,isLoading:K,isError:$}=R("inventories",()=>I.fetchInventories()),{data:W}=R("products",()=>J.fetchProducts()),X=async o=>{if(confirm(`Continue with the operation. Delete ${o.name} ?`)){const e=await I.deleteInventory({uuid:o.uuid});e.status==="success"?(w.refetchQueries("inventories"),d(e.message,"green","top")):d("There was an error","red","top-right")}},Y=()=>{Q.value="Create Inventory",g.value=!0,V.value=!1},Z=o=>{Q.value=`Update Actual Quantity for  ${o.product}`,A.value=o,q.value=!0},ee=async()=>{y.value="";const o={product_uuid:r.product_id.uuid,measurement_name:r.product_id.measurement,quantity:r.quantity,buying_price:r.buying_price};if(o.product_uuid&&o.measurement_name&&o.quantity&&o.buying_price){const a=await I.createInventory(o);a.status==="success"?(w.refetchQueries("inventories"),r.product_id="",r.measurement_id="",r.quantity=1,r.buying_price=1,g.value=!1,d(a.message,"green","top")):(y.value=a.message,d(a.message,"red","top-right"))}else y.value="Product, Quantity and Buying Price are required!",d("Product, Quantity and Buying Price are required!","red","top-right")},M=async()=>{const o={actual_quantity:Number(r.actual_quantity),inventory_uuid:A.value.uuid};if(o.actual_quantity){const a=await I.updateInventory(o);a.status==="success"?(w.refetchQueries("inventories"),r.actual_quantity="",g.value=!1,q.value=!1,V.value=!1,Q.value="",d(a.message,"green","top")):d("There was an error","red","top-right")}else y.value="Name is required!",d("Name is required!","red","top-right")},z=()=>{g.value=!1,q.value=!1,r.product_id="",r.quantity=1,r.actual_quantity=1,r.buying_price=1,A.value="",y.value=""},d=(o,a,e)=>{p.notify({message:o,color:a,position:e})},te=o=>{const a=o.map(e=>({name:e.name,inventories:e.inventories.length,created_at:e.created_at}));me(a,H,pe,p,"InventoriesData")};return(o,a)=>(f(),C("div",be,[c(K)?(f(),C("div",qe,"Loading inventories...")):c($)?(f(),C("div",Qe,"An error has occurred: "+i(c($)),1)):(f(),U(se,{key:2,title:"Inventories",rows:c(T),columns:c(H),pagination:c(B),"onUpdate:pagination":a[2]||(a[2]=e=>ie(B)?B.value=e:null),separator:"cell","row-key":"name",filter:P.value,dense:""},{body:n(e=>[t(ne,{props:e},{default:n(()=>[t(s,{key:"product",props:e},{default:n(()=>[u(i(e.row.product),1)]),_:2},1032,["props"]),t(s,{key:"buying_price",props:e},{default:n(()=>[u(i(e.row.buying_price),1)]),_:2},1032,["props"]),t(s,{key:"quantity",props:e},{default:n(()=>[u(i(e.row.quantity),1)]),_:2},1032,["props"]),t(s,{key:"actual_quantity",props:e},{default:n(()=>[u(i(e.row.actual_quantity),1)]),_:2},1032,["props"]),t(s,{key:"measurement",props:e},{default:n(()=>[u(i(e.row.measurement),1)]),_:2},1032,["props"]),t(s,{key:"department",props:e},{default:n(()=>[u(i(e.row.department),1)]),_:2},1032,["props"]),t(s,{key:"user",props:e},{default:n(()=>[u(i(e.row.user),1)]),_:2},1032,["props"]),t(s,{key:"created_at",props:e},{default:n(()=>[u(i(e.row.created_at),1)]),_:2},1032,["props"]),t(s,{key:"actions",props:e},{default:n(()=>[t(E,{color:"blue",name:"edit",onClick:ae=>Z(e.row),style:{cursor:"pointer"},size:"20px",class:"q-mr-md"},null,8,["onClick"]),t(E,{color:"red",name:"delete",onClick:ae=>X(e.row),style:{cursor:"pointer"},size:"20px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),"top-right":n(()=>[t(h,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:P.value,"onUpdate:modelValue":a[0]||(a[0]=e=>P.value=e),placeholder:"Search",class:"q-mr-md"},{append:n(()=>[t(E,{name:"search"})]),_:1},8,["modelValue"]),t(ue,null,{default:n(()=>[t(v,{onClick:Y,dense:"",color:"primary",icon:"add",label:"Add"}),t(v,{dense:"",flat:"",color:"primary","icon-right":"archive",label:"Export",class:"q-ml-sm","no-caps":"",onClick:a[1]||(a[1]=e=>te(c(T)))})]),_:1})]),_:1},8,["rows","columns","pagination","filter"])),t(L,{modelValue:q.value,"onUpdate:modelValue":a[4]||(a[4]=e=>q.value=e),persistent:""},{default:n(()=>[t(G,{style:{width:"500px"}},{default:n(()=>[t(F,null,{default:n(()=>[u(i(Q.value),1)]),_:1}),t(x,null,{default:n(()=>[t(h,{dense:"",outlined:"",modelValue:r.actual_quantity,"onUpdate:modelValue":a[3]||(a[3]=e=>r.actual_quantity=e),label:"Actual Quantity",type:"number"},null,8,["modelValue"])]),_:1}),k("div",ke,[k("small",null,i(y.value),1)]),t(j,{align:"right"},{default:n(()=>[t(v,{flat:"",label:"Cancel",color:"red",onClick:z}),t(D),t(v,{flat:"",label:"Edit Inventory",color:"primary",onClick:M})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(L,{modelValue:g.value,"onUpdate:modelValue":a[8]||(a[8]=e=>g.value=e),persistent:""},{default:n(()=>[t(G,{style:{width:"500px"}},{default:n(()=>[t(F,null,{default:n(()=>[k("div",we,i(Q.value),1),t(D),r.product_id?(f(),C("small",Ie,[t(O,{class:"q-mr-sm"},{default:n(()=>[u("Measurement: "+i(r.product_id.measurement),1)]),_:1}),t(O,null,{default:n(()=>[u("Available Quantity: "+i(r.product_id.quantity),1)]),_:1})])):S("",!0)]),_:1}),t(x,null,{default:n(()=>[t(ce,{dense:"",outlined:"",modelValue:r.product_id,"onUpdate:modelValue":a[5]||(a[5]=e=>r.product_id=e),options:c(W),"option-value":"uuid","option-label":"name",label:"Select Product"},null,8,["modelValue","options"])]),_:1}),t(x,null,{default:n(()=>[t(h,{dense:"",outlined:"",modelValue:r.quantity,"onUpdate:modelValue":a[6]||(a[6]=e=>r.quantity=e),label:"Product Quantity",type:"number"},null,8,["modelValue"])]),_:1}),t(x,null,{default:n(()=>[t(h,{dense:"",outlined:"",modelValue:r.buying_price,"onUpdate:modelValue":a[7]||(a[7]=e=>r.buying_price=e),label:"Buying Price",type:"number"},null,8,["modelValue"])]),_:1}),k("div",Ve,[k("small",null,i(y.value),1)]),t(j,{align:"right"},{default:n(()=>[t(v,{flat:"",label:"Cancel",color:"red",onClick:z}),t(D),r.product_id&&!V.value?(f(),U(v,{key:0,flat:"",label:"Add Inventory",color:"primary",onClick:ee})):S("",!0),r.product_id&&V.value?(f(),U(v,{key:1,flat:"",label:"Edit Inventory",color:"primary",onClick:M})):S("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Fe as default};
