import{Q as O}from"./QBadge.7d0f551b.js";import{a as V,Q as N}from"./QCard.e2497511.js";import{c5 as de,r as c,c as ie,aI as _,a5 as x,a6 as o,P as u,u as g,a3 as Q,bb as a,b as ce,d as e,a4 as P,ac as r,bD as D,F as me,aO as pe,bE as y,M as _e}from"./index.81829c36.js";import{Q as E}from"./QInput.8b4b83b3.js";import{Q as ve,a as H,p as fe,c as U,d as C,b as ye}from"./paginations.8ce1f6e2.js";import{p as F,n as M,o as d}from"./rtl.6808dcc1.js";import{Q as ge}from"./QSeparator.282f0250.js";import{Q as he}from"./QBtnGroup.cc7f595b.js";import{Q as R}from"./QToolbar.17c5c26f.js";import{a as be}from"./use-quasar.dff4cff8.js";import{u as j}from"./index.56f65f5a.js";import{p as qe}from"./product_columns.33f8ffe3.js";import{u as Qe}from"./product-store.bc382cfe.js";import{u as Se}from"./payment-mode-store.b1fad9f5.js";import{u as ke}from"./sale-store.d7eb0e1c.js";import{p as we}from"./print.15699711.js";import"./use-dark.e1850cb8.js";import"./module_calls.421761b7.js";import"./helpers.73a7253f.js";import"./_commonjsHelpers.6150b38b.js";const xe={class:"q-pa-md"},Pe={class:"row",style:{overflow:"hidden"}},Ce={class:"q-pa-xs col-xs-12 col-sm-6 col-md-7",style:{overflow:"auto"}},Ve={style:{color:"red"}},Ne={key:0},Be={key:1},$e=["onClick"],Ae={style:{color:"#017951"}},De=o("hr",null,null,-1),Ee=o("hr",null,null,-1),Ue=o("br",null,null,-1),Me=o("br",null,null,-1),Ie={key:0,class:"q-pa-xs col-xs-12 col-sm-6 col-md-5",style:{overflow:"auto"}},Le=o("i",null,"New Bill",-1),Te={style:{color:"orange"}},Oe=o("br",null,null,-1),He=o("br",null,null,-1),Fe=o("hr",null,null,-1),Re={class:"text-h6"},je={class:"text-center error_msg"},ze=o("div",{class:"text-h6"},"Make Payment",-1),Ge={class:"q-mt-sm"},Ke={class:"text-center error_msg"},yl={__name:"Operations",setup(Ye){const I=de(),z=be(),G=Qe(),K=Se(),L=ke(),B=fe(10),h=c(!1),S=c(!1),k=c(!0),$=c(""),i=c(1),b=c(1),q=c(""),Y=c(""),v=c(""),A=c(""),m=c(""),n=c([]),{data:J,isLoading:W,isError:T}=j("products",()=>G.fetchProducts()),{data:X}=j("payment_modes",()=>K.fetchPaymentModes()),Z=s=>{v.value="",A.value="",n.value.some(t=>t.name==s.name)?(v.value="Product already added to the bill! Select a different product.",A.value="Product already added to the bill! Select a different product.",f(`${s.name} already added to the bill!`,"red","top")):(S.value=!0,m.value=s)},ee=()=>{h.value=!0},le=()=>{S.value=!1,m.value="",i.value=1},ae=()=>{if(i.value>m.value.quantity)v.value=`${i.value} is more than the maximum available quantity`,f(`${i.value} is more than the maximum available quantity`,"red","top");else{const s={uuid:m.value.uuid,name:m.value.name,price:m.value.selling_price,quantity:i.value};n.value.push(s),f(`${m.value.name} added to cart!`,"green","top"),S.value=!1,m.value="",i.value=1}},w=ie(()=>{let s=0;return n.value.forEach(t=>{s+=t.quantity*t.price}),s}),te=s=>n.value.splice(s,1),oe=()=>{confirm("Are you sure?")&&(n.value=[])},se=async()=>{let s=[];n.value.forEach(l=>s.push({name:l.name,quantity:l.quantity,uuid:l.uuid}));const t={products:s,payment_mode_uuid:q.value.uuid,bill_status:"sold"};if(k.value?(t.selling_price=Number(w.value),t.actual_selling_price=Number(w.value)):(t.selling_price=Number(w.value),t.actual_selling_price=Number(b.value)),t.selling_price&&t.payment_mode_uuid){const l=await L.createSaleOperation(t);l.status==="success"?(q.value="",i.value="",h.value=!1,n.value=[],I.push("/bills"),f(l.message,"green","top")):(v.value=l.message,f(l.message,"red","top-right"))}else v.value="Name is required!",f("Name is required!","red","top-right")},ue=async()=>{var l;let s=[];n.value.forEach(p=>s.push({name:p.name,quantity:p.quantity,uuid:p.uuid}));const t={products:s};if((l=t==null?void 0:t.products)!=null&&l.length){const p=await L.createHoldBillOperation(t);p.status==="success"?(q.value="",i.value="",h.value=!1,n.value=[],I.push("/bills"),f(p.message,"green","top")):(v.value=p.message,f(p.message,"red","top-right"))}else v.value="Name is required!",f("Name is required!","red","top-right")},re=()=>{h.value=!1,i.value="",Y.value="",v.value=""},f=(s,t,l)=>{z.notify({message:s,color:t,position:l})},ne=()=>{we({printable:n.value,properties:["name","quantity"],type:"json",gridHeaderStyle:"color: red;  border: 2px solid #3971A5;",gridStyle:"border: 2px solid #3971A5;"})};return(s,t)=>(_(),x("div",xe,[o("div",Pe,[o("div",Ce,[o("small",Ve,u(A.value),1),g(W)?(_(),x("div",Ne,"Loading products...")):g(T)?(_(),x("div",Be,"An error has occurred: "+u(g(T)),1)):(_(),Q(ve,{key:2,title:"Make Sale (All Products)",rows:g(J),columns:g(qe),pagination:g(B),"onUpdate:pagination":t[1]||(t[1]=l=>ce(B)?B.value=l:null),separator:"cell","row-key":"name",filter:$.value,dense:"",grid:""},{item:a(l=>[o("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4",onClick:p=>Z(l.row)},[e(V,{bordered:"",class:"selected_product"},{default:a(()=>[e(N,{class:"text-center"},{default:a(()=>[o("strong",Ae,u(l.row.name),1),De,o("small",null,[o("i",null,[r("Selling Price: "),o("b",null,"Ksh "+u(l.row.selling_price),1)])]),Ee,o("small",null,[o("i",null,"Category: "+u(l.row.category),1)]),Ue,o("small",null,[o("i",null,"Department: "+u(l.row.department),1)]),o("small",null,[e(O,{color:"orange"},{default:a(()=>[r("Available Quantity "),Me,r(u(l.row.quantity)+" "+u(l.row.measurement),1)]),_:2},1024)])]),_:2},1024)]),_:2},1024)],8,$e)]),"top-right":a(()=>[e(E,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:$.value,"onUpdate:modelValue":t[0]||(t[0]=l=>$.value=l),placeholder:"Search product...",class:"q-mr-md"},{append:a(()=>[e(D,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","pagination","filter"]))]),n.value.length>0?(_(),x("div",Ie,[e(V,{bordered:""},{default:a(()=>[e(U,null,{default:a(()=>[Le,r(),e(C),o("span",Te,"(Items: "+u(n.value.length)+")",1)]),_:1}),e(N,null,{default:a(()=>[e(F,{bordered:"",separator:"",dense:"",class:"bill"},{default:a(()=>[e(M,null,{default:a(()=>[e(d,null,{default:a(()=>[r("Name")]),_:1}),e(d,{style:{color:"white"}},{default:a(()=>[r("Price")]),_:1}),e(d,{style:{color:"white"}},{default:a(()=>[r("Quantity")]),_:1}),e(d,{side:"",style:{color:"white"}},{default:a(()=>[r("Total")]),_:1}),e(d,{avatar:""},{default:a(()=>[e(D,{class:"select_list",name:"delete",dense:"",color:"white",onClick:oe})]),_:1})]),_:1})]),_:1}),Oe,e(F,{bordered:"",separator:"",dense:""},{default:a(()=>[(_(!0),x(me,null,pe(n.value,(l,p)=>(_(),Q(M,{key:l.uuid},{default:a(()=>[e(d,null,{default:a(()=>[r(u(l.name),1)]),_:2},1024),e(d,null,{default:a(()=>[r(u(l.price),1)]),_:2},1024),e(d,null,{default:a(()=>[r(u(l.quantity),1)]),_:2},1024),e(d,{side:""},{default:a(()=>[r(u(l.price*l.quantity),1)]),_:2},1024),e(d,{avatar:""},{default:a(()=>[e(D,{class:"select_list",name:"delete",dense:"",color:"red",onClick:Je=>te(p)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(ge,{color:"orange"}),e(M,null,{default:a(()=>[e(d,null,{default:a(()=>[r("Total")]),_:1}),e(d,{avatar:""},{default:a(()=>[r(u(w.value),1)]),_:1}),e(d,{avatar:""})]),_:1})]),_:1}),He,e(he,{spread:"",rounded:""},{default:a(()=>[e(y,{dense:"",color:"primary",label:"Sale",icon:"dashboard",onClick:ee}),e(y,{dense:"",color:"orange",label:"Hold Bill",icon:"dashboard",onClick:ue})]),_:1}),Fe,e(y,{color:"primary",flat:"",dense:"",class:"full-width",label:"Print Bill",icon:"download",onClick:ne})]),_:1})]),_:1})])):P("",!0)]),e(H,{modelValue:S.value,"onUpdate:modelValue":t[3]||(t[3]=l=>S.value=l),persistent:""},{default:a(()=>[e(V,{style:{width:"500px"}},{default:a(()=>[e(R,null,{default:a(()=>[o("div",Re,"Sale : "+u(m.value.name),1),e(C),o("small",null,[e(O,null,{default:a(()=>[r(u(m.value.measurement),1)]),_:1})])]),_:1}),e(N,{class:"q-pt-none"},{default:a(()=>[e(E,{autofocus:"",outlined:"",dense:"",label:"Product Quantity",modelValue:i.value,"onUpdate:modelValue":t[2]||(t[2]=l=>i.value=l),type:"number",hint:`Note : You can sale a maximum of ${m.value.quantity}`},null,8,["modelValue","hint"])]),_:1}),o("div",je,[o("small",null,u(v.value),1)]),e(U,{align:"right"},{default:a(()=>[e(y,{flat:"",label:"Cancel",color:"red",onClick:le}),e(C),i.value?(_(),Q(y,{key:0,flat:"",label:"Add Product",color:"primary",onClick:ae})):P("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(H,{modelValue:h.value,"onUpdate:modelValue":t[7]||(t[7]=l=>h.value=l),persistent:""},{default:a(()=>[e(V,{style:{width:"500px"}},{default:a(()=>[e(R,null,{default:a(()=>[ze,e(C),o("small",Ge,[e(y,{dense:"",outline:"",color:"blue",depressed:"",class:_e(`${k.value?"":"actual_selling_price"}`),onClick:t[4]||(t[4]=l=>k.value=!k.value),label:`Expected Selling Price : ${w.value}`},null,8,["class","label"])])]),_:1}),e(N,{class:"q-pt-none"},{default:a(()=>[k.value?P("",!0):(_(),Q(E,{key:0,autofocus:"",outlined:"",dense:"",label:"Actual Selling Price",modelValue:b.value,"onUpdate:modelValue":t[5]||(t[5]=l=>b.value=l),class:"q-pa-xs col-xs-12 col-sm-6 col-md-6 q-mb-sm",type:"number"},null,8,["modelValue"])),b.value&&b.value>0?(_(),Q(ye,{key:1,dense:"",outlined:"",modelValue:q.value,"onUpdate:modelValue":t[6]||(t[6]=l=>q.value=l),options:g(X),"option-value":"uuid","option-label":"name",label:"Select Payment Mode"},null,8,["modelValue","options"])):P("",!0)]),_:1}),o("div",Ke,[o("small",null,u(v.value),1)]),e(U,{align:"right"},{default:a(()=>[e(y,{flat:"",label:"Cancel",color:"red",onClick:re}),e(C),b.value&&q.value?(_(),Q(y,{key:0,flat:"",label:"Sale",color:"primary",onClick:se})):P("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{yl as default};
