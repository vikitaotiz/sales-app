import{Q as b}from"./QCardSection.c4d9c7a4.js";import{Q as C}from"./QCard.202a61f3.js";import{bA as re,c as ue,h as ne,bB as de,bX as ie,r as n,aI as d,a5 as Q,a6 as o,P as i,u as v,a3 as w,bb as t,b as ce,d as e,a4 as x,bV as I,ac as B,F as pe,aO as me,bY as f}from"./index.cc8e0a4c.js";import{Q as L}from"./QInput.84e9bbf0.js";import{Q as _e,a as H,p as ve,b as fe}from"./paginations.423e3bf9.js";import{Q as M,a as E}from"./QCardActions.d38781e4.js";import{l as T,j as F,k}from"./QList.17de517e.js";import{u as ye}from"./use-quasar.97a158a2.js";import{u as G}from"./index.aacaa6ad.js";import{u as ge,p as he}from"./product-store.2311c6ab.js";import{u as be}from"./payment-mode-store.aad926a4.js";import{u as ke}from"./sale-store.d13b1b87.js";import{p as Se}from"./print.15699711.js";import"./use-dark.9af58fdb.js";import"./QSeparator.7d727be5.js";import"./module_calls.421761b7.js";import"./helpers.73a7253f.js";import"./_commonjsHelpers.6150b38b.js";var qe=re({name:"QBtnGroup",props:{unelevated:Boolean,outline:Boolean,flat:Boolean,rounded:Boolean,square:Boolean,push:Boolean,stretch:Boolean,glossy:Boolean,spread:Boolean},setup(N,{slots:P}){const A=ue(()=>{const V=["unelevated","outline","flat","rounded","square","push","stretch","glossy"].filter(S=>N[S]===!0).map(S=>`q-btn-group--${S}`).join(" ");return`q-btn-group row no-wrap${V.length!==0?" "+V:""}`+(N.spread===!0?" q-btn-group--spread":" inline")});return()=>ne("div",{class:A.value},de(P.default))}});const Qe={class:"q-pa-md"},we={class:"row",style:{overflow:"hidden"}},Be={class:"q-pa-xs col-xs-12 col-sm-6 col-md-8",style:{overflow:"auto"}},Pe={style:{color:"red"}},Ve={key:0},Ce={key:1},xe=["onClick"],Ne={style:{color:"#017951"}},Ae=o("hr",null,null,-1),Ue={key:0,class:"q-pa-xs col-xs-12 col-sm-6 col-md-4",style:{overflow:"auto"}},$e=o("i",null,"New Bill",-1),De={style:{color:"orange"}},Ie=o("br",null,null,-1),Le=o("br",null,null,-1),Me=o("hr",null,null,-1),Ee={class:"text-h6"},Oe={class:"text-center error_msg"},je=o("div",{class:"text-h6"},"Make Payment",-1),He={class:"text-center error_msg"},nl={__name:"Operations",setup(N){const P=ie(),A=ye(),V=ge(),S=be(),O=ke(),U=ve(10),y=n(!1),q=n(!1),$=n(""),c=n(0),g=n(0),h=n(""),R=n(""),p=n(""),D=n(""),_=n(""),r=n([]),{data:X,isLoading:Y,isError:j}=G("products",()=>V.fetchProducts()),{data:z}=G("payment_modes",()=>S.fetchPaymentModes()),J=s=>{p.value="",D.value="",r.value.some(a=>a.name==s.name)?(p.value="Product already added to the bill! Select a different product.",D.value="Product already added to the bill! Select a different product.",m(`${s.name} already added to the bill!`,"red","top")):(q.value=!0,_.value=s)},K=()=>{y.value=!0},W=()=>{q.value=!1,_.value="",c.value=""},Z=()=>{const s={uuid:_.value.uuid,name:_.value.name,quantity:c.value};r.value.push(s),m(`${_.value.name} added to cart!`,"green","top"),q.value=!1,_.value="",c.value=""},ee=s=>r.value.splice(s,1),le=()=>{confirm("Are you sure?")&&(r.value=[])},te=async()=>{let s=[];r.value.forEach(l=>s.push({name:l.name,quantity:l.quantity,uuid:l.uuid}));const a={products:s,selling_price:g.value.trim(),payment_mode_uuid:h.value.uuid,bill_status:"sold"};if(a.selling_price){const l=await O.createSaleOperation(a);l.status==="success"?(h.value="",c.value="",y.value=!1,r.value=[],P.push("/bills"),m(l.message,"green","top")):(p.value=l.message,m(l.message,"red","top-right"))}else p.value="Name is required!",m("Name is required!","red","top-right")},ae=async()=>{var l;let s=[];r.value.forEach(u=>s.push({name:u.name,quantity:u.quantity,uuid:u.uuid}));const a={products:s};if(console.log(a),(l=a==null?void 0:a.products)!=null&&l.length){const u=await O.createHoldBillOperation(a);u.status==="success"?(h.value="",c.value="",y.value=!1,r.value=[],P.push("/bills"),m(u.message,"green","top")):(p.value=u.message,m(u.message,"red","top-right"))}else p.value="Name is required!",m("Name is required!","red","top-right")},oe=()=>{y.value=!1,c.value="",R.value="",p.value=""},m=(s,a,l)=>{A.notify({message:s,color:a,position:l})},se=()=>{Se({printable:r.value,properties:["name","quantity"],type:"json",gridHeaderStyle:"color: red;  border: 2px solid #3971A5;",gridStyle:"border: 2px solid #3971A5;"})};return(s,a)=>(d(),Q("div",Qe,[o("div",we,[o("div",Be,[o("small",Pe,i(D.value),1),v(Y)?(d(),Q("div",Ve,"Loading products...")):v(j)?(d(),Q("div",Ce,"An error has occurred: "+i(v(j)),1)):(d(),w(_e,{key:2,title:"Make Sale (All Products)",rows:v(X),columns:v(he),pagination:v(U),"onUpdate:pagination":a[1]||(a[1]=l=>ce(U)?U.value=l:null),separator:"cell","row-key":"name",filter:$.value,dense:"",grid:""},{item:t(l=>[o("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-3",onClick:u=>J(l.row)},[e(C,{bordered:"",class:"selected_product"},{default:t(()=>[e(b,{class:"text-center"},{default:t(()=>[o("strong",Ne,i(l.row.name),1),Ae,o("small",null,[o("i",null,"Category: "+i(l.row.category),1)])]),_:2},1024)]),_:2},1024)],8,xe)]),"top-right":t(()=>[e(L,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:$.value,"onUpdate:modelValue":a[0]||(a[0]=l=>$.value=l),placeholder:"Search product...",class:"q-mr-md"},{append:t(()=>[e(I,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","pagination","filter"]))]),r.value.length>0?(d(),Q("div",Ue,[e(C,{bordered:""},{default:t(()=>[e(M,null,{default:t(()=>[$e,B(),e(E),o("span",De,"(Items: "+i(r.value.length)+")",1)]),_:1}),e(b,null,{default:t(()=>[e(T,{bordered:"",separator:"",dense:"",class:"bill"},{default:t(()=>[e(F,null,{default:t(()=>[e(k,null,{default:t(()=>[B("Name")]),_:1}),e(k,{side:"",style:{color:"white"}},{default:t(()=>[B("Quantity")]),_:1}),e(k,{avatar:""},{default:t(()=>[e(I,{class:"select_list",name:"delete",dense:"",color:"white",onClick:le})]),_:1})]),_:1})]),_:1}),Ie,e(T,{bordered:"",separator:"",dense:""},{default:t(()=>[(d(!0),Q(pe,null,me(r.value,(l,u)=>(d(),w(F,{key:l.uuid},{default:t(()=>[e(k,null,{default:t(()=>[B(i(l.name),1)]),_:2},1024),e(k,{side:""},{default:t(()=>[B(i(l.quantity),1)]),_:2},1024),e(k,{avatar:""},{default:t(()=>[e(I,{class:"select_list",name:"delete",dense:"",color:"red",onClick:Te=>ee(u)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),Le,e(qe,{spread:"",rounded:""},{default:t(()=>[e(f,{dense:"",color:"primary",label:"Sale",icon:"dashboard",onClick:K}),e(f,{dense:"",color:"orange",label:"Hold Bill",icon:"dashboard",onClick:ae})]),_:1}),Me,e(f,{color:"primary",flat:"",dense:"",class:"full-width",label:"Print Bill",icon:"download",onClick:se})]),_:1})]),_:1})])):x("",!0)]),e(H,{modelValue:q.value,"onUpdate:modelValue":a[3]||(a[3]=l=>q.value=l),persistent:""},{default:t(()=>[e(C,{style:{width:"500px"}},{default:t(()=>[e(b,null,{default:t(()=>[o("div",Ee,"Sale : "+i(_.value.name),1)]),_:1}),e(b,{class:"q-pt-none"},{default:t(()=>[e(L,{autofocus:"",outlined:"",dense:"",label:"Product Quantity",modelValue:c.value,"onUpdate:modelValue":a[2]||(a[2]=l=>c.value=l),type:"number"},null,8,["modelValue"])]),_:1}),o("div",Oe,[o("small",null,i(p.value),1)]),e(M,{align:"right"},{default:t(()=>[e(f,{flat:"",label:"Cancel",color:"red",onClick:W}),e(E),c.value?(d(),w(f,{key:0,flat:"",label:"Add Product",color:"primary",onClick:Z})):x("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(H,{modelValue:y.value,"onUpdate:modelValue":a[6]||(a[6]=l=>y.value=l),persistent:""},{default:t(()=>[e(C,{style:{width:"500px"}},{default:t(()=>[e(b,null,{default:t(()=>[je]),_:1}),e(b,{class:"q-pt-none"},{default:t(()=>[e(L,{autofocus:"",outlined:"",dense:"",label:"Selling Price",modelValue:g.value,"onUpdate:modelValue":a[4]||(a[4]=l=>g.value=l),class:"q-mb-sm",type:"number"},null,8,["modelValue"]),g.value&&g.value>0?(d(),w(fe,{key:0,dense:"",outlined:"",modelValue:h.value,"onUpdate:modelValue":a[5]||(a[5]=l=>h.value=l),options:v(z),"option-value":"uuid","option-label":"name",label:"Select Payment Mode"},null,8,["modelValue","options"])):x("",!0)]),_:1}),o("div",He,[o("small",null,i(p.value),1)]),e(M,{align:"right"},{default:t(()=>[e(f,{flat:"",label:"Cancel",color:"red",onClick:oe}),e(E),g.value&&h.value?(d(),w(f,{key:0,flat:"",label:"Sale Product(s)",color:"primary",onClick:te})):x("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{nl as default};
