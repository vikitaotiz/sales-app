import{Q as g,a as Z,e as ee,b as te}from"./excel.2d59e30c.js";import{bA as ae,c as F,h as se,bU as le,b$ as re,b_ as oe,r as v,aI as o,a5 as u,u as p,P as c,a3 as N,bb as s,b as ne,d as a,ac as b,F as I,aO as R,a4 as B,bV as D,bY as V,a6 as y}from"./index.cc8e0a4c.js";import{Q as M}from"./QInput.84e9bbf0.js";import{Q as ie,a as ue,p as de}from"./paginations.423e3bf9.js";import{Q as O}from"./QCardSection.c4d9c7a4.js";import{Q as ce,a as me}from"./QCardActions.d38781e4.js";import{Q as fe}from"./QCard.202a61f3.js";import{u as _e}from"./use-quasar.97a158a2.js";import{a as ge,u as ve}from"./index.aacaa6ad.js";import{g as pe,p as T}from"./module_calls.421761b7.js";import"./use-dark.9af58fdb.js";import"./QSeparator.7d727be5.js";import"./QList.17de517e.js";import"./helpers.73a7253f.js";const be=["top","middle","bottom"];var A=ae({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:t=>be.includes(t)}},setup(t,{slots:i}){const h=F(()=>t.align!==void 0?{verticalAlign:t.align}:null),k=F(()=>{const w=t.outline===!0&&t.color||t.textColor;return`q-badge flex inline items-center no-wrap q-badge--${t.multiLine===!0?"multi":"single"}-line`+(t.outline===!0?" q-badge--outline":t.color!==void 0?` bg-${t.color}`:"")+(w!==void 0?` text-${w}`:"")+(t.floating===!0?" q-badge--floating":"")+(t.rounded===!0?" q-badge--rounded":"")+(t.transparent===!0?" q-badge--transparent":"")});return()=>se("div",{class:k.value,style:h.value,role:"status","aria-label":t.label},le(i.default,t.label!==void 0?[t.label]:[]))}});const P=[{name:"name",required:!0,label:"Name",align:"left",field:t=>t.name,format:t=>`${t}`,sortable:!0},{name:"email",align:"center",label:"Email",field:"email",sortable:!0},{name:"roles",align:"center",label:"Roles",field:"roles",sortable:!0},{name:"departments",align:"center",label:"Departments",field:"departments",sortable:!0},{name:"active",align:"center",label:"Status",field:"active",sortable:!0},{name:"created_at",align:"center",label:"Created On",field:"created_at",sortable:!0},{name:"actions",align:"center",label:"Actions",field:"created_at"}],Q=re(),m=Q==null?void 0:Q.token,ye=oe("users",{state:()=>({users:[]}),actions:{async fetchUsers(){if(m){const t=await pe("users",m);return this.users=t==null?void 0:t.data,this.users}},async createUser(t){var i;if(t.uuid=(i=Q==null?void 0:Q.user)==null?void 0:i.uuid,m)return await T(t,"users",m)},async updateUser(t){if(m)return await T(t,"update_user",m)},async deleteUser(t){if(m)return await T(t,"delete_user",m)}}});const he={class:"q-pa-md"},ke={key:0},we={key:1},Ue=y("br",null,null,-1),Qe={key:0},Ce=y("small",null,"No Role Assigned",-1),xe=[Ce],qe=y("br",null,null,-1),Ne={key:0},Ve=y("small",null,"No Department Assigned",-1),Se=[Ve],Be={class:"text-h6"},Ae={class:"text-center error_msg"},Ge={__name:"Users",setup(t){const i=_e(),h=ge(),k=ye(),w=de(10),f=v(!1),C=v(!1),E=v(""),S=v(""),n=v(""),$=v(""),U=v(""),{data:L,isLoading:Y,isError:z}=ve("users",()=>k.fetchUsers()),j=async l=>{if(confirm(`Continue with the operation. Delete ${l.name} ?`)){const e=await k.deleteUser({uuid:l.uuid});e.status==="success"?(h.refetchQueries("users"),d(e.message,"green","top")):d("There was an error","red","top-right")}},G=()=>{S.value="Add New User",f.value=!0,C.value=!1},H=l=>{C.value=!0,S.value=`Edit ${l.name}`,n.value=l.name,$.value=l.uuid,f.value=!0},J=async()=>{if(U.value="",n.value.trim()){const l=await k.createUser({name:n.value.trim()});l.status==="success"?(h.refetchQueries("users"),n.value="",f.value=!1,d(l.message,"green","top")):(U.value=l.message,d(l.message,"red","top-right"))}else U.value="Name is required!",d("Name is required!","red","top-right")},K=async()=>{const l={name:n.value.trim(),uuid:$.value};if(l.name){const r=await k.updateUser(l);r.status==="success"?(h.refetchQueries("users"),n.value="",f.value=!1,C.value=!1,S.value="",d(r.message,"green","top")):d("There was an error","red","top-right")}else U.value="Name is required!",d("Name is required!","red","top-right")},W=()=>{f.value=!1,n.value="",$.value="",U.value=""},d=(l,r,e)=>{i.notify({message:l,color:r,position:e})},X=l=>{const r=l.map(e=>({name:e.name,users:e.users.length,created_at:e.created_at}));ee(r,P,te,i,"UsersData")};return(l,r)=>(o(),u("div",he,[p(Y)?(o(),u("div",ke,"Loading users...")):p(z)?(o(),u("div",we,"An error has occurred: "+c(p(z)),1)):(o(),N(ie,{key:2,title:"Users",rows:p(L),columns:p(P),pagination:p(w),"onUpdate:pagination":r[2]||(r[2]=e=>ne(w)?w.value=e:null),separator:"cell","row-key":"name",filter:E.value,dense:""},{body:s(e=>[a(Z,{props:e},{default:s(()=>[a(g,{key:"name",props:e},{default:s(()=>[b(c(e.row.name),1)]),_:2},1032,["props"]),a(g,{key:"email",props:e},{default:s(()=>[b(c(e.row.email),1)]),_:2},1032,["props"]),a(g,{key:"roles",props:e},{default:s(()=>{var _,x;return[(o(!0),u(I,null,R(e.row.roles,q=>(o(),u("div",{key:q.uuid},[a(A,null,{default:s(()=>[b(c(q.name),1)]),_:2},1024),Ue]))),128)),((x=(_=e.row)==null?void 0:_.roles)==null?void 0:x.length)===0?(o(),u("div",Qe,xe)):B("",!0)]}),_:2},1032,["props"]),a(g,{key:"departments",props:e},{default:s(()=>{var _,x;return[(o(!0),u(I,null,R(e.row.departments,q=>(o(),u("div",{key:q.uuid},[a(A,{color:"green"},{default:s(()=>[b(c(q.name),1)]),_:2},1024),qe]))),128)),((x=(_=e.row)==null?void 0:_.departments)==null?void 0:x.length)===0?(o(),u("div",Ne,Se)):B("",!0)]}),_:2},1032,["props"]),a(g,{key:"active",props:e},{default:s(()=>[e.row.active?(o(),N(A,{key:0},{default:s(()=>[b(" Enabled ")]),_:1})):(o(),N(A,{key:1,color:"red"},{default:s(()=>[b(" Disbled ")]),_:1}))]),_:2},1032,["props"]),a(g,{key:"created_at",props:e},{default:s(()=>[b(c(e.row.created_at),1)]),_:2},1032,["props"]),a(g,{key:"actions",props:e},{default:s(()=>[a(D,{color:"blue",name:"edit",onClick:_=>H(e.row),style:{cursor:"pointer"},size:"20px",class:"q-mr-md"},null,8,["onClick"]),a(D,{color:"red",name:"delete",onClick:_=>j(e.row),style:{cursor:"pointer"},size:"20px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),"top-right":s(()=>[a(M,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:E.value,"onUpdate:modelValue":r[0]||(r[0]=e=>E.value=e),placeholder:"Search",class:"q-mr-md"},{append:s(()=>[a(D,{name:"search"})]),_:1},8,["modelValue"]),a(V,{onClick:G,round:"",dense:"",color:"primary",size:"small",icon:"add"}),a(V,{dense:"",flat:"",color:"primary","icon-right":"archive",label:"Export",class:"q-ml-sm","no-caps":"",onClick:r[1]||(r[1]=e=>X(p(L)))})]),_:1},8,["rows","columns","pagination","filter"])),a(ue,{modelValue:f.value,"onUpdate:modelValue":r[4]||(r[4]=e=>f.value=e),persistent:""},{default:s(()=>[a(fe,{style:{width:"500px"}},{default:s(()=>[a(O,null,{default:s(()=>[y("div",Be,c(S.value),1)]),_:1}),a(O,{class:"q-pt-none"},{default:s(()=>[a(M,{outlined:"",dense:"",label:"Name",modelValue:n.value,"onUpdate:modelValue":r[3]||(r[3]=e=>n.value=e)},null,8,["modelValue"])]),_:1}),y("div",Ae,[y("small",null,c(U.value),1)]),a(ce,{align:"right"},{default:s(()=>[a(V,{flat:"",label:"Cancel",color:"red",onClick:W}),a(me),n.value&&!C.value?(o(),N(V,{key:0,flat:"",label:"Add User",color:"primary",onClick:J})):B("",!0),n.value&&C.value?(o(),N(V,{key:1,flat:"",label:"Edit User",color:"primary",onClick:K})):B("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Ge as default};
