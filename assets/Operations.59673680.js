import{a as V,Q as q}from"./QCard.f00deb23.js";import{c2 as re,r as d,c as ne,aI as m,a5 as w,a6 as o,P as u,u as h,a3 as k,bb as t,b as de,d as e,a4 as P,ac as i,bV as $,F as ie,aO as ce,c3 as y,M as me}from"./index.45153cc6.js";import{Q as D}from"./QInput.ab909322.js";import{Q as pe,a as O,p as _e,c as E,d as C,b as ve}from"./paginations.c737fe8f.js";import{n as H,l as M,m as n}from"./rtl.0b6f6848.js";import{Q as fe}from"./QSeparator.a467f888.js";import{Q as ye,p as ge}from"./print.b2f1c743.js";import{Q as he}from"./QToolbar.33e7fc43.js";import{a as be}from"./uid.86e7d13e.js";import{u as F}from"./index.830cf3e9.js";import{p as Se}from"./product_columns.7602ac4c.js";import{u as ke}from"./product-store.3801730d.js";import{u as Qe}from"./payment-mode-store.d6ec0210.js";import{u as qe}from"./sale-store.b8891880.js";import"./use-dark.0d0b0ba9.js";import"./_commonjsHelpers.6150b38b.js";import"./module_calls.421761b7.js";import"./helpers.73a7253f.js";const we={class:"q-pa-md"},Pe={class:"row",style:{overflow:"hidden"}},xe={class:"q-pa-xs col-xs-12 col-sm-6 col-md-7",style:{overflow:"auto"}},Ve={style:{color:"red"}},Ce={key:0},Ne={key:1},Be=["onClick"],Ae={style:{color:"#017951"}},Ue=o("hr",null,null,-1),$e=o("hr",null,null,-1),De=o("br",null,null,-1),Ee={key:0,class:"q-pa-xs col-xs-12 col-sm-6 col-md-5",style:{overflow:"auto"}},Me=o("i",null,"New Bill",-1),Ie={style:{color:"orange"}},Le=o("br",null,null,-1),Te=o("br",null,null,-1),Oe=o("hr",null,null,-1),He={class:"text-h6"},Fe={class:"text-center error_msg"},Re=o("div",{class:"text-h6"},"Make Payment",-1),je={class:"q-mt-sm"},ze={class:"text-center error_msg"},pl={__name:"Operations",setup(Ge){const I=re(),R=be(),j=ke(),z=Qe(),L=qe(),N=_e(10),b=d(!1),Q=d(!1),x=d(!0),B=d(""),p=d(1),g=d(1),S=d(""),G=d(""),_=d(""),A=d(""),v=d(""),r=d([]),{data:K,isLoading:J,isError:T}=F("products",()=>j.fetchProducts()),{data:W}=F("payment_modes",()=>z.fetchPaymentModes()),X=s=>{_.value="",A.value="",r.value.some(a=>a.name==s.name)?(_.value="Product already added to the bill! Select a different product.",A.value="Product already added to the bill! Select a different product.",f(`${s.name} already added to the bill!`,"red","top")):(Q.value=!0,v.value=s)},Y=()=>{b.value=!0},Z=()=>{Q.value=!1,v.value="",p.value=""},ee=()=>{const s={uuid:v.value.uuid,name:v.value.name,price:v.value.selling_price,quantity:p.value};r.value.push(s),f(`${v.value.name} added to cart!`,"green","top"),Q.value=!1,v.value="",p.value=""},U=ne(()=>{let s=0;return r.value.forEach(a=>{s+=a.quantity*a.price}),s}),le=s=>r.value.splice(s,1),te=()=>{confirm("Are you sure?")&&(r.value=[])},ae=async()=>{let s=[];r.value.forEach(l=>s.push({name:l.name,quantity:l.quantity,uuid:l.uuid}));const a={products:s,selling_price:Number(U.value),actual_selling_price:g.value?Number(g.value.trim()):0,payment_mode_uuid:S.value.uuid,bill_status:"sold"};if(a.selling_price&&a.payment_mode_uuid){const l=await L.createSaleOperation(a);l.status==="success"?(S.value="",p.value="",b.value=!1,r.value=[],I.push("/bills"),f(l.message,"green","top")):(_.value=l.message,f(l.message,"red","top-right"))}else _.value="Name is required!",f("Name is required!","red","top-right")},oe=async()=>{var l;let s=[];r.value.forEach(c=>s.push({name:c.name,quantity:c.quantity,uuid:c.uuid}));const a={products:s};if((l=a==null?void 0:a.products)!=null&&l.length){const c=await L.createHoldBillOperation(a);c.status==="success"?(S.value="",p.value="",b.value=!1,r.value=[],I.push("/bills"),f(c.message,"green","top")):(_.value=c.message,f(c.message,"red","top-right"))}else _.value="Name is required!",f("Name is required!","red","top-right")},se=()=>{b.value=!1,p.value="",G.value="",_.value=""},f=(s,a,l)=>{R.notify({message:s,color:a,position:l})},ue=()=>{ge({printable:r.value,properties:["name","quantity"],type:"json",gridHeaderStyle:"color: red;  border: 2px solid #3971A5;",gridStyle:"border: 2px solid #3971A5;"})};return(s,a)=>(m(),w("div",we,[o("div",Pe,[o("div",xe,[o("small",Ve,u(A.value),1),h(J)?(m(),w("div",Ce,"Loading products...")):h(T)?(m(),w("div",Ne,"An error has occurred: "+u(h(T)),1)):(m(),k(pe,{key:2,title:"Make Sale (All Products)",rows:h(K),columns:h(Se),pagination:h(N),"onUpdate:pagination":a[1]||(a[1]=l=>de(N)?N.value=l:null),separator:"cell","row-key":"name",filter:B.value,dense:"",grid:""},{item:t(l=>[o("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4",onClick:c=>X(l.row)},[e(V,{bordered:"",class:"selected_product"},{default:t(()=>[e(q,{class:"text-center"},{default:t(()=>[o("strong",Ae,u(l.row.name),1),Ue,o("small",null,[o("i",null,[i("Selling Price: "),o("b",null,"Ksh "+u(l.row.selling_price),1)])]),$e,o("small",null,[o("i",null,"Category: "+u(l.row.category),1)]),De,o("small",null,[o("i",null,"Department: "+u(l.row.department),1)])]),_:2},1024)]),_:2},1024)],8,Be)]),"top-right":t(()=>[e(D,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:B.value,"onUpdate:modelValue":a[0]||(a[0]=l=>B.value=l),placeholder:"Search product...",class:"q-mr-md"},{append:t(()=>[e($,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","pagination","filter"]))]),r.value.length>0?(m(),w("div",Ee,[e(V,{bordered:""},{default:t(()=>[e(E,null,{default:t(()=>[Me,i(),e(C),o("span",Ie,"(Items: "+u(r.value.length)+")",1)]),_:1}),e(q,null,{default:t(()=>[e(H,{bordered:"",separator:"",dense:"",class:"bill"},{default:t(()=>[e(M,null,{default:t(()=>[e(n,null,{default:t(()=>[i("Name")]),_:1}),e(n,{style:{color:"white"}},{default:t(()=>[i("Price")]),_:1}),e(n,{style:{color:"white"}},{default:t(()=>[i("Quantity")]),_:1}),e(n,{side:"",style:{color:"white"}},{default:t(()=>[i("Total")]),_:1}),e(n,{avatar:""},{default:t(()=>[e($,{class:"select_list",name:"delete",dense:"",color:"white",onClick:te})]),_:1})]),_:1})]),_:1}),Le,e(H,{bordered:"",separator:"",dense:""},{default:t(()=>[(m(!0),w(ie,null,ce(r.value,(l,c)=>(m(),k(M,{key:l.uuid},{default:t(()=>[e(n,null,{default:t(()=>[i(u(l.name),1)]),_:2},1024),e(n,null,{default:t(()=>[i(u(l.price),1)]),_:2},1024),e(n,null,{default:t(()=>[i(u(l.quantity),1)]),_:2},1024),e(n,{side:""},{default:t(()=>[i(u(l.price*l.quantity),1)]),_:2},1024),e(n,{avatar:""},{default:t(()=>[e($,{class:"select_list",name:"delete",dense:"",color:"red",onClick:Ke=>le(c)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(fe,{color:"orange"}),e(M,null,{default:t(()=>[e(n,null,{default:t(()=>[i("Total")]),_:1}),e(n,{avatar:""},{default:t(()=>[i(u(U.value),1)]),_:1}),e(n,{avatar:""})]),_:1})]),_:1}),Te,e(ye,{spread:"",rounded:""},{default:t(()=>[e(y,{dense:"",color:"primary",label:"Sale",icon:"dashboard",onClick:Y}),e(y,{dense:"",color:"orange",label:"Hold Bill",icon:"dashboard",onClick:oe})]),_:1}),Oe,e(y,{color:"primary",flat:"",dense:"",class:"full-width",label:"Print Bill",icon:"download",onClick:ue})]),_:1})]),_:1})])):P("",!0)]),e(O,{modelValue:Q.value,"onUpdate:modelValue":a[3]||(a[3]=l=>Q.value=l),persistent:""},{default:t(()=>[e(V,{style:{width:"500px"}},{default:t(()=>[e(q,null,{default:t(()=>[o("div",He,"Sale : "+u(v.value.name),1)]),_:1}),e(q,{class:"q-pt-none"},{default:t(()=>[e(D,{autofocus:"",outlined:"",dense:"",label:"Product Quantity",modelValue:p.value,"onUpdate:modelValue":a[2]||(a[2]=l=>p.value=l),type:"number"},null,8,["modelValue"])]),_:1}),o("div",Fe,[o("small",null,u(_.value),1)]),e(E,{align:"right"},{default:t(()=>[e(y,{flat:"",label:"Cancel",color:"red",onClick:Z}),e(C),p.value?(m(),k(y,{key:0,flat:"",label:"Add Product",color:"primary",onClick:ee})):P("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(O,{modelValue:b.value,"onUpdate:modelValue":a[7]||(a[7]=l=>b.value=l),persistent:""},{default:t(()=>[e(V,{style:{width:"500px"}},{default:t(()=>[e(he,null,{default:t(()=>[Re,e(C),o("small",je,[e(y,{dense:"",outline:"",color:"blue",depressed:"",class:me(`${x.value?"":"actual_selling_price"}`),onClick:a[4]||(a[4]=l=>x.value=!x.value),label:`Expected Selling Price : ${U.value}`},null,8,["class","label"])])]),_:1}),e(q,{class:"q-pt-none"},{default:t(()=>[x.value?P("",!0):(m(),k(D,{key:0,autofocus:"",outlined:"",dense:"",label:"Actual Selling Price",modelValue:g.value,"onUpdate:modelValue":a[5]||(a[5]=l=>g.value=l),class:"q-pa-xs col-xs-12 col-sm-6 col-md-6 q-mb-sm",type:"number"},null,8,["modelValue"])),g.value&&g.value>0?(m(),k(ve,{key:1,dense:"",outlined:"",modelValue:S.value,"onUpdate:modelValue":a[6]||(a[6]=l=>S.value=l),options:h(W),"option-value":"uuid","option-label":"name",label:"Select Payment Mode"},null,8,["modelValue","options"])):P("",!0)]),_:1}),o("div",ze,[o("small",null,u(_.value),1)]),e(E,{align:"right"},{default:t(()=>[e(y,{flat:"",label:"Cancel",color:"red",onClick:se}),e(C),g.value&&S.value?(m(),k(y,{key:0,flat:"",label:"Sale",color:"primary",onClick:ae})):P("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{pl as default};
