import{Q as f,a as ae,e as te,b as le}from"./excel.3aab7a77.js";import{Q as S}from"./QBadge.0154458d.js";import{b$ as re,b_ as oe,r as _,j as ne,aI as n,a5 as i,u,P as d,a3 as V,bb as t,b as ie,d as a,ac as v,F as L,aO as P,a4 as A,bV as R,bY as Q,a6 as b}from"./index.524120c0.js";import{Q as C}from"./QInput.541db684.js";import{Q as ue,a as de,p as me,b as ce,c as pe,d as fe}from"./paginations.f938412d.js";import{a as _e,Q as O}from"./QCard.20fff7d5.js";import{u as ve}from"./use-quasar.59f3c9af.js";import{a as be,u as Y}from"./index.7a02f42d.js";import{g as ge,p as z}from"./module_calls.421761b7.js";import{u as ye}from"./role-store.1e96c3d5.js";import"./use-dark.fb3d7a1e.js";import"./QSeparator.e6579368.js";import"./QList.588244c0.js";import"./helpers.73a7253f.js";const j=[{name:"name",required:!0,label:"Name",align:"left",field:o=>o.name,format:o=>`${o}`,sortable:!0},{name:"email",align:"center",label:"Email",field:"email",sortable:!0},{name:"roles",align:"center",label:"Roles",field:"roles",sortable:!0},{name:"departments",align:"center",label:"Departments",field:"departments",sortable:!0},{name:"active",align:"center",label:"Status",field:"active",sortable:!0},{name:"created_at",align:"center",label:"Created On",field:"created_at",sortable:!0},{name:"actions",align:"center",label:"Actions",field:"created_at"}],w=re(),m=w==null?void 0:w.token,we=oe("users",{state:()=>({users:[]}),actions:{async fetchUsers(){if(m){const o=await ge("users",m);return this.users=o==null?void 0:o.data,this.users}},async createUser(o){var c;if(o.uuid=(c=w==null?void 0:w.user)==null?void 0:c.uuid,m)return await z(o,"users",m)},async updateUser(o){if(m)return await z(o,"update_user",m)},async deleteUser(o){if(m)return await z(o,"delete_user",m)}}});const he={class:"q-pa-md"},ke={key:0},Ue={key:1},Ve=b("br",null,null,-1),Qe={key:0},Ce=b("small",null,"No Role Assigned",-1),qe=[Ce],xe=b("br",null,null,-1),Ne={key:0},Ee=b("small",null,"No Department Assigned",-1),Se=[Ee],Ae={class:"text-h6"},De={class:"text-center error_msg"},He={__name:"Users",setup(o){const c=ve(),D=be(),q=we(),M=ye(),$=me(10),g=_(!1),h=_(!1),T=_(""),x=_(""),N=_(""),l=ne({name:"",phone:"",email:"",password:"",role_uuids:[]}),B=_(""),E=_(""),{data:F,isLoading:G,isError:I}=Y("users",()=>q.fetchUsers()),{data:H}=Y("roles",()=>M.fetchRoles()),J=async r=>{if(confirm(`Continue with the operation. Delete ${r.name} ?`)){const e=await q.deleteUser({uuid:r.uuid});e.status==="success"?(D.refetchQueries("users"),y(e.message,"green","top")):y("There was an error","red","top-right")}},K=()=>{x.value="Add New User",g.value=!0,h.value=!1},W=r=>{h.value=!0,x.value=`Edit ${r.name}`,N.value=r.name,B.value=r.uuid,g.value=!0},X=async()=>{const r={name:l.name.trim(),email:l.email.trim(),phone:l.phone.trim(),role_uuids:l==null?void 0:l.role_uuids.map(s=>s.uuid),password:l.password.trim()};if(r.name&&r.email&&r.password){const s=await q.createUser(r);console.log(s)}else E.value="Name is required!",y("Name is required!","red","top-right")},Z=async()=>{const r={name:N.value.trim(),uuid:B.value};if(r.name){const s=await q.updateUser(r);s.status==="success"?(D.refetchQueries("users"),N.value="",g.value=!1,h.value=!1,x.value="",y(s.message,"green","top")):y("There was an error","red","top-right")}else E.value="Name is required!",y("Name is required!","red","top-right")},ee=()=>{g.value=!1,N.value="",B.value="",E.value=""},y=(r,s,e)=>{c.notify({message:r,color:s,position:e})},se=r=>{const s=r.map(e=>({name:e.name,users:e.users.length,created_at:e.created_at}));te(s,j,le,c,"UsersData")};return(r,s)=>(n(),i("div",he,[u(G)?(n(),i("div",ke,"Loading users...")):u(I)?(n(),i("div",Ue,"An error has occurred: "+d(u(I)),1)):(n(),V(ue,{key:2,title:"Users",rows:u(F),columns:u(j),pagination:u($),"onUpdate:pagination":s[2]||(s[2]=e=>ie($)?$.value=e:null),separator:"cell","row-key":"name",filter:T.value,dense:""},{body:t(e=>[a(ae,{props:e},{default:t(()=>[a(f,{key:"name",props:e},{default:t(()=>[v(d(e.row.name),1)]),_:2},1032,["props"]),a(f,{key:"email",props:e},{default:t(()=>[v(d(e.row.email),1)]),_:2},1032,["props"]),a(f,{key:"roles",props:e},{default:t(()=>{var p,k;return[(n(!0),i(L,null,P(e.row.roles,U=>(n(),i("div",{key:U.uuid},[a(S,null,{default:t(()=>[v(d(U.name),1)]),_:2},1024),Ve]))),128)),((k=(p=e.row)==null?void 0:p.roles)==null?void 0:k.length)===0?(n(),i("div",Qe,qe)):A("",!0)]}),_:2},1032,["props"]),a(f,{key:"departments",props:e},{default:t(()=>{var p,k;return[(n(!0),i(L,null,P(e.row.departments,U=>(n(),i("div",{key:U.uuid},[a(S,{color:"green"},{default:t(()=>[v(d(U.name),1)]),_:2},1024),xe]))),128)),((k=(p=e.row)==null?void 0:p.departments)==null?void 0:k.length)===0?(n(),i("div",Ne,Se)):A("",!0)]}),_:2},1032,["props"]),a(f,{key:"active",props:e},{default:t(()=>[e.row.active?(n(),V(S,{key:0},{default:t(()=>[v(" Enabled ")]),_:1})):(n(),V(S,{key:1,color:"red"},{default:t(()=>[v(" Disbled ")]),_:1}))]),_:2},1032,["props"]),a(f,{key:"created_at",props:e},{default:t(()=>[v(d(e.row.created_at),1)]),_:2},1032,["props"]),a(f,{key:"actions",props:e},{default:t(()=>[a(R,{color:"blue",name:"edit",onClick:p=>W(e.row),style:{cursor:"pointer"},size:"20px",class:"q-mr-md"},null,8,["onClick"]),a(R,{color:"red",name:"delete",onClick:p=>J(e.row),style:{cursor:"pointer"},size:"20px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),"top-right":t(()=>[a(C,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:T.value,"onUpdate:modelValue":s[0]||(s[0]=e=>T.value=e),placeholder:"Search",class:"q-mr-md"},{append:t(()=>[a(R,{name:"search"})]),_:1},8,["modelValue"]),a(Q,{onClick:K,round:"",dense:"",color:"primary",size:"small",icon:"add"}),a(Q,{dense:"",flat:"",color:"primary","icon-right":"archive",label:"Export",class:"q-ml-sm","no-caps":"",onClick:s[1]||(s[1]=e=>se(u(F)))})]),_:1},8,["rows","columns","pagination","filter"])),a(de,{modelValue:g.value,"onUpdate:modelValue":s[8]||(s[8]=e=>g.value=e),persistent:""},{default:t(()=>[a(_e,{style:{width:"500px"}},{default:t(()=>[a(O,null,{default:t(()=>[b("div",Ae,d(x.value),1)]),_:1}),a(O,{class:"q-pt-none"},{default:t(()=>[a(C,{class:"q-mb-sm",outlined:"",dense:"",label:"Name",modelValue:l.name,"onUpdate:modelValue":s[3]||(s[3]=e=>l.name=e)},null,8,["modelValue"]),a(C,{class:"q-mb-sm",outlined:"",dense:"",label:"Phone",modelValue:l.phone,"onUpdate:modelValue":s[4]||(s[4]=e=>l.phone=e)},null,8,["modelValue"]),a(C,{class:"q-mb-sm",outlined:"",dense:"",label:"Email",modelValue:l.email,"onUpdate:modelValue":s[5]||(s[5]=e=>l.email=e),type:"email"},null,8,["modelValue"]),a(ce,{dense:"",multiple:"","use-chips":"",hint:"You can assign a user multiple roles.",outlined:"",modelValue:l.role_uuids,"onUpdate:modelValue":s[6]||(s[6]=e=>l.role_uuids=e),options:u(H),"option-value":"uuid","option-label":"name",label:"Select Role",class:"q-mb-sm"},null,8,["modelValue","options"]),a(C,{class:"q-mb-sm",outlined:"",dense:"",label:"Password",modelValue:l.password,"onUpdate:modelValue":s[7]||(s[7]=e=>l.password=e),type:"password"},null,8,["modelValue"])]),_:1}),b("div",De,[b("small",null,d(E.value),1)]),a(pe,{align:"right"},{default:t(()=>[a(Q,{flat:"",label:"Cancel",color:"red",onClick:ee}),a(fe),l.name&&!h.value?(n(),V(Q,{key:0,flat:"",label:"Add User",color:"primary",onClick:X})):A("",!0),l.name&&h.value?(n(),V(Q,{key:1,flat:"",label:"Edit User",color:"primary",onClick:Z})):A("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{He as default};
