import{c4 as ye,r as c,c as ge,aI as u,a5 as k,u as C,P as i,a3 as _,bb as s,b as be,d as t,a6 as n,bE as m,bD as J,ac as r,a4 as y,F as he,aO as we,M as W,aL as ke,aJ as Ce}from"./index.4cc15ae0.js";import{Q as z}from"./QInput.b6b22fe0.js";import{Q as Se,a as X,p as qe,d as $,b as Z,c as ee}from"./paginations.e029229d.js";import{Q as H}from"./QToolbar.35d4155d.js";import{Q as K}from"./QSeparator.ff169c9f.js";import{Q as T}from"./QBadge.b1768c93.js";import{p as le,n as te,o as g}from"./rtl.dae9c57e.js";import{Q as N,a as R}from"./QCard.ad75a669.js";import{Q as Pe}from"./QBtnGroup.ccafa59e.js";import{a as Qe}from"./use-quasar.b9178eb8.js";import{u as xe}from"./sale-store.5d6c452c.js";import{u as Ve}from"./product-store.182fc3a9.js";import{u as Be}from"./payment-mode-store.c92aa198.js";import{a as $e,u as Y}from"./index.14e2de4d.js";import{p as Ne}from"./print.15699711.js";import"./use-dark.f889e447.js";import"./module_calls.421761b7.js";import"./helpers.73a7253f.js";import"./_commonjsHelpers.6150b38b.js";const Ae=(b,p)=>{const A=b.reduce((I,q)=>I+q.total,0);return`<div style="text-align: center; padding: 10px; border: 1px solid grey; paddinng: 5px; margin-bottom: 20px; width: 100%">
    <h1>${p.title}</h1>
    <ul>
      <li>Total Cost : ${A}</li>
      <li>Payment Mode : ${p.payment_mode}</li>
      <li>Status : ${p.status}</li>
      <li>Created By : ${p.user}</li>
      <li>Created On : ${p.created_at}</li>
      </li>
    </ul>
  </div>`},Ie=(b,p,A)=>{const x=Ae(b,A);Ne({header:x,printable:b,properties:p,type:"json",gridHeaderStyle:"font-weight: bold; border: 2px solid;",gridStyle:"border-collapse: collapse; border: 1px solid;"})};const S=b=>(ke("data-v-36d9ff19"),b=b(),Ce(),b),De={class:"q-pa-md"},Ue={key:0},Ee={key:1},Le={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},Me={key:1,class:"text-center"},Te={class:"text-center"},Fe=S(()=>n("br",null,null,-1)),Oe=S(()=>n("br",null,null,-1)),ze={key:0},He=S(()=>n("hr",null,null,-1)),Ke={key:1},Re=S(()=>n("hr",null,null,-1)),Ye=S(()=>n("hr",null,null,-1)),je=S(()=>n("b",null,"Add Product",-1)),Ge={key:0},Je=S(()=>n("hr",null,null,-1)),We={class:"text-center error_msg"},Xe=S(()=>n("div",{class:"text-h6"},"Make Payment",-1)),Ze={class:"q-mt-sm"},el={class:"text-center error_msg"},ll={__name:"Bills",setup(b){const p=$e(),A=Qe(),x=qe(10),I=c(""),q=xe(),ae=Ve(),se=Be(),w=c(!1),D=c(!0),U=c(!1),h=c(1),V=c(1),f=c(""),d=c(""),E=c(""),P=c(""),B=c([]),L=c([]),{data:F,isLoading:oe,isError:j}=Y("bills",()=>q.fetchBills(),{onSuccess:a=>{L.value=a.map(l=>({user:l.user,uuid:l.uuid,status:l.status,payment_mode:l.payment_mode,selling_price:l.selling_price,actual_selling_price:l.actual_selling_price,created_at:l.created_at,sales:l.sales}))}});Y("products",()=>ae.fetchProducts(),{onSuccess:a=>{B.value=a.map(l=>({uuid:l.uuid,name:l.name,price:l.selling_price,category:l.category,department:l.department,quantity:l.quantity}))}});const{data:ue}=Y("payment_modes",()=>se.fetchPaymentModes()),O=c(B.value),ne=a=>{f.value=a,w.value=!0},M=ge(()=>{let a=0;return f.value.sales.forEach(l=>{a+=l.selling_price*l.quantity}),a}),ie=a=>{f.value=a,U.value=!0},re=()=>{w.value=!1,d.value="",h.value=1,P.value=""},de=async()=>{if(f.value.sales.some(a=>a.name===d.value.name))P.value="Product already added to the bill",v("Product already added to the bill","red","top-right");else if(h.value>d.value.quantity)P.value=`${h.value} is more than the maximum available quantity`,v(`${h.value} is more than the maximum available quantity`,"red","top");else{const a=await q.addProductToBill({bill_uuid:f.value.uuid,uuid:d.value.uuid,name:d.value.name,selling_price:d.value.price,quantity:h.value});a.status=="success"?(p.refetchQueries("bills"),f.value="",w.value=!1,v(a.message,"green","top")):(f.value="",w.value=!1,v(a.message,"red","top"))}},ce=()=>{U.value=!1},me=async a=>{if(confirm("Are you sure?")){const e=await q.removeProductFromBill({product_uuid:a.uuid});e.status=="success"?(p.refetchQueries("bills"),v(e.message,"green","top")):(f.value="",w.value=!1,v(e.message,"red","top"))}},pe=async a=>{if(confirm("Are you sure?")){const e=await q.deleteBill({bill_uuid:a.uuid});e.status=="success"?(p.refetchQueries("bills"),v(e.message,"green","top")):(f.value="",w.value=!1,v(e.message,"red","top"))}},_e=async()=>{let a=[];f.value.sales.forEach(e=>a.push({name:e.name,quantity:e.quantity,uuid:e.uuid}));const l={bill_uuid:f.value.uuid,products:a,payment_mode_uuid:E.value.uuid,bill_status:"sold"};if(D.value?(l.selling_price=Number(M.value),l.actual_selling_price=Number(M.value)):(l.selling_price=Number(M.value),l.actual_selling_price=Number(V.value)),l.actual_selling_price&&l.payment_mode_uuid){const e=await q.updateSaleOperation(l);e.status==="success"?(p.refetchQueries("bills"),E.value="",h.value="",U.value=!1,v(e.message,"green","top")):(P.value=e.message,v(e.message,"red","top-right"))}else P.value="Name is required!",v("Name is required!","red","top-right")},fe=(a,l)=>{a.length>0&&(B.value.includes(a)||B.value.push(a),l(a,"toggle"))},ve=(a,l)=>{l(()=>{if(a==="")O.value=B.value;else{const e=a.toLowerCase();O.value=B.value.filter(o=>o.name.toLowerCase().indexOf(e)>-1)}})},G=a=>{const l=[];a.sales.forEach(o=>{l.push({name:o.name,quantity:o.quantity,price:o.selling_price,total:o.quantity*o.selling_price})});const e={title:"Sales Receipt",status:a.status==="sold"?"Sold":"Pending Payment",user:a.user,payment_mode:a.payment_mode};Ie(l,["name","quantity","price","total"],e)},v=(a,l,e)=>{A.notify({message:a,color:l,position:e})};return(a,l)=>(u(),k("div",De,[C(oe)?(u(),k("div",Ue,"Loading bills...")):C(j)?(u(),k("div",Ee,"An error has occurred: "+i(C(j)),1)):(u(),_(Se,{key:2,grid:"",flat:"",bordered:"",title:"Sold/Pending Bills",rows:L.value,"row-key":"user",filter:I.value,pagination:C(x),"onUpdate:pagination":l[4]||(l[4]=e=>be(x)?x.value=e:null)},{"top-right":s(()=>[n("div",null,[t(m,{dense:"",color:"primary",label:"All Bills",onClick:l[0]||(l[0]=e=>{var o;return L.value=(o=C(F))==null?void 0:o.filter(Q=>Q)}),class:"q-mr-sm"}),t(m,{dense:"",color:"blue",label:"Sold Bills",onClick:l[1]||(l[1]=e=>{var o;return L.value=(o=C(F))==null?void 0:o.filter(Q=>Q.status==="sold")}),class:"q-mr-sm"}),t(m,{dense:"",color:"brown",label:"Pending Bills",onClick:l[2]||(l[2]=e=>{var o;return L.value=(o=C(F))==null?void 0:o.filter(Q=>Q.status==="pending")}),class:"q-mr-sm"})]),t(z,{dense:"",debounce:"300",modelValue:I.value,"onUpdate:modelValue":l[3]||(l[3]=e=>I.value=e),placeholder:"Search"},{append:s(()=>[t(J,{name:"search"})]),_:1},8,["modelValue"])]),item:s(e=>[n("div",Le,[t(R,{bordered:"",class:W(`${e.row.status=="pending"?"sale_pending":""}`)},{default:s(()=>[t(N,null,{default:s(()=>[e.row.status==="pending"?(u(),_(H,{key:0},{default:s(()=>[n("strong",null,"Created by : "+i(e.row.user),1),r(),t($),t(m,{round:"",dense:"",color:"primary",size:"small",icon:"add",onClick:o=>ne(e.row)},null,8,["onClick"]),t(m,{dense:"",flat:"",round:"",color:"red",icon:"delete",onClick:o=>pe(e.row)},null,8,["onClick"])]),_:2},1024)):(u(),k("div",Me,[n("strong",null,"Created by : "+i(e.row.user),1),r(),t($)])),t(K,{class:"q-mb-sm"}),n("div",Te,[n("small",null,"Created On : "+i(e.row.created_at),1),r(),Fe,n("small",null,[t(T,{color:`${e.row.status=="pending"?"red":""}`},{default:s(()=>[r("Status : "+i(e.row.status)+" ",1),Oe,r(" Mode : "+i(e.row.payment_mode),1)]),_:2},1032,["color"])])]),t(K,{class:"q-mb-sm"}),t(le,{dense:"",bordered:"",separator:"",class:"bill"},{default:s(()=>[t(te,null,{default:s(()=>[t(g,null,{default:s(()=>[r("Name")]),_:1}),t(g,null,{default:s(()=>[r("Price")]),_:1}),t(g,{style:{color:"white"}},{default:s(()=>[r("Quantity")]),_:1}),t(g,{style:{color:"white"}},{default:s(()=>[r("Total")]),_:1}),e.row.status==="pending"?(u(),_(g,{key:0},{default:s(()=>[r("Action")]),_:1})):y("",!0)]),_:2},1024)]),_:2},1024),t(le,{dense:"",bordered:"",separator:""},{default:s(()=>[(u(!0),k(he,null,we(e.row.sales,(o,Q)=>(u(),_(te,{key:Q},{default:s(()=>[t(g,null,{default:s(()=>[r(i(o.name),1)]),_:2},1024),t(g,null,{default:s(()=>[r(i(o.selling_price),1)]),_:2},1024),t(g,null,{default:s(()=>[r(i(o.quantity),1)]),_:2},1024),t(g,null,{default:s(()=>[r(i(o.quantity*o.selling_price),1)]),_:2},1024),e.row.status==="pending"?(u(),_(g,{key:0},{default:s(()=>[t(J,{name:"delete",color:"red",onClick:tl=>me(o),style:{cursor:"pointer"}},null,8,["onClick"])]),_:2},1024)):y("",!0)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024),t(K),t(N,{class:"flex flex-center"},{default:s(()=>[e.row.status==="sold"?(u(),k("b",ze,"Expected Price Ksh "+i(e.row.selling_price),1)):y("",!0),He,e.row.status==="sold"?(u(),k("b",Ke,"Actual Price Ksh "+i(e.row.actual_selling_price),1)):y("",!0),Re]),_:2},1024),Ye,t(N,{style:{padding:"0"}},{default:s(()=>[e.row.status==="sold"?(u(),_(m,{key:0,class:"full-width",dense:"",flat:"",onClick:o=>G(e.row),label:"Print Bill",icon:"download",color:"primary"},null,8,["onClick"])):(u(),_(Pe,{key:1,push:"",class:"full-width"},{default:s(()=>[t(m,{class:"full-width",dense:"",flat:"",onClick:o=>G(e.row),label:"Print Bill",icon:"download",color:"primary"},null,8,["onClick"]),t(m,{dense:"",flat:"",push:"",color:"orange",class:"full-width",label:"Sale",icon:"dashboard",onClick:o=>ie(e.row)},null,8,["onClick"])]),_:2},1024))]),_:2},1024)]),_:2},1032,["class"])])]),_:1},8,["rows","filter","pagination"])),t(X,{modelValue:w.value,"onUpdate:modelValue":l[7]||(l[7]=e=>w.value=e),persistent:""},{default:s(()=>[t(R,{style:{width:"500px"}},{default:s(()=>[t(N,null,{default:s(()=>[t(H,null,{default:s(()=>[je,t($),d.value?(u(),k("small",Ge,[t(T,{class:"q-mr-sm",color:"blue"},{default:s(()=>[r("Price: "+i(d.value.price),1)]),_:1}),t(T,{class:"q-mr-sm",color:"blue"},{default:s(()=>[r("Category: "+i(d.value.category),1)]),_:1}),t(T,{class:"q-mr-sm",color:"blue"},{default:s(()=>[r("Department: "+i(d.value.department),1)]),_:1})])):y("",!0)]),_:1}),Je,t(Z,{dense:"","use-input":"",outlined:"",modelValue:d.value,"onUpdate:modelValue":l[5]||(l[5]=e=>d.value=e),"input-debounce":"0",onNewValue:fe,options:O.value,onFilter:ve,"option-value":"uuid","option-label":"name",label:"Select Product to add",hint:"You can type in the product name for quick search..."},null,8,["modelValue","options"])]),_:1}),t(N,{class:"q-pt-none"},{default:s(()=>[d.value?(u(),_(z,{key:0,outlined:"",dense:"",label:"Product Quantity",modelValue:h.value,"onUpdate:modelValue":l[6]||(l[6]=e=>h.value=e),type:"number",hint:`Note : You can sale a maximum of ${d.value.quantity}`},null,8,["modelValue","hint"])):y("",!0)]),_:1}),n("div",We,[n("small",null,i(P.value),1)]),t(ee,{align:"right"},{default:s(()=>[t(m,{flat:"",label:"Cancel",color:"red",onClick:re}),t($),h.value&&d.value?(u(),_(m,{key:0,flat:"",label:"Add Product",color:"primary",onClick:de})):y("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(X,{modelValue:U.value,"onUpdate:modelValue":l[11]||(l[11]=e=>U.value=e),persistent:""},{default:s(()=>[t(R,{style:{width:"500px"}},{default:s(()=>[t(H,null,{default:s(()=>[Xe,t($),n("small",Ze,[t(m,{dense:"",color:"blue",depressed:"",class:W(`${D.value?"":"actual_selling_price"}`),onClick:l[8]||(l[8]=e=>D.value=!D.value),label:`Expected Selling Price : ${M.value}`},null,8,["class","label"])])]),_:1}),t(N,{class:"q-pt-none"},{default:s(()=>[D.value?y("",!0):(u(),_(z,{key:0,autofocus:"",outlined:"",dense:"",label:"Actual Selling Price",modelValue:V.value,"onUpdate:modelValue":l[9]||(l[9]=e=>V.value=e),class:"q-pa-xs col-xs-12 col-sm-6 col-md-6 q-mb-sm",type:"number"},null,8,["modelValue"])),V.value&&V.value>0?(u(),_(Z,{key:1,dense:"",outlined:"",modelValue:E.value,"onUpdate:modelValue":l[10]||(l[10]=e=>E.value=e),options:C(ue),"option-value":"uuid","option-label":"name",label:"Select Payment Mode"},null,8,["modelValue","options"])):y("",!0)]),_:1}),n("div",el,[n("small",null,i(P.value),1)]),t(ee,{align:"right"},{default:s(()=>[t(m,{flat:"",label:"Cancel",color:"red",onClick:ce}),t($),V.value&&E.value?(u(),_(m,{key:0,flat:"",label:"Sale",color:"primary",onClick:_e})):y("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};var kl=ye(ll,[["__scopeId","data-v-36d9ff19"]]);export{kl as default};
