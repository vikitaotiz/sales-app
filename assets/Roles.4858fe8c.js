import{Q as w,a as G,e as H,b as J}from"./excel.f2d77cbb.js";import{b$ as K,b_ as W,r as c,aI as f,a5 as x,u as m,P as v,a3 as V,bb as o,b as X,d as t,ac as N,bV as q,bY as y,a6 as E,a4 as S}from"./index.51a259cb.js";import{Q as T}from"./QInput.3cac8ad5.js";import{Q as Z,a as ee,p as ae}from"./paginations.773ea2d0.js";import{Q as U}from"./QCardSection.c70e5739.js";import{Q as te,a as se}from"./QCardActions.9ad23381.js";import{Q as le}from"./QCard.0e884d39.js";import{u as oe}from"./use-quasar.b3f68725.js";import{a as re,u as ne}from"./index.3312b787.js";import{g as ie,p as $}from"./module_calls.421761b7.js";import"./use-dark.c8311098.js";import"./QSeparator.14c12cc4.js";import"./QList.11dc4b6b.js";import"./helpers.73a7253f.js";const B=[{name:"name",required:!0,label:"Name",align:"left",field:l=>l.name,format:l=>`${l}`,sortable:!0},{name:"users",align:"center",label:"Users",field:"users",sortable:!0},{name:"created_at",align:"center",label:"Created On",field:"created_at",sortable:!0},{name:"actions",align:"center",label:"Actions",field:"created_at"}],_=K(),i=_==null?void 0:_.token,ue=W("roles",{state:()=>({roles:[]}),actions:{async fetchRoles(){if(i){const l=await ie("roles",i);return this.roles=l==null?void 0:l.data,this.roles}},async createRole(l){var u;if(l.uuid=(u=_==null?void 0:_.user)==null?void 0:u.uuid,i)return await $(l,"roles",i)},async updateRole(l){if(i)return await $(l,"update_role",i)},async deleteRole(l){if(i)return await $(l,"delete_role",i)}}});const de={class:"q-pa-md"},ce={key:0},me={key:1},pe={class:"text-h6"},fe={class:"text-center error_msg"},qe={__name:"Roles",setup(l){const u=oe(),b=re(),h=ue(),Q=ae(10),d=c(!1),g=c(!1),R=c(""),k=c(""),r=c(""),C=c(""),p=c(""),{data:A,isLoading:z,isError:D}=ne("roles",()=>h.fetchRoles()),I=async a=>{if(confirm(`Continue with the operation. Delete ${a.name} ?`)){const e=await h.deleteRole({uuid:a.uuid});e.status==="success"?(b.refetchQueries("roles"),n(e.message,"green","top")):n("There was an error","red","top-right")}},L=()=>{k.value="Add New Role",d.value=!0,g.value=!1},F=a=>{g.value=!0,k.value=`Edit ${a.name}`,r.value=a.name,C.value=a.uuid,d.value=!0},M=async()=>{if(p.value="",r.value.trim()){const a=await h.createRole({name:r.value.trim()});a.status==="success"?(b.refetchQueries("roles"),r.value="",d.value=!1,n(a.message,"green","top")):(p.value=a.message,n(a.message,"red","top-right"))}else p.value="Name is required!",n("Name is required!","red","top-right")},O=async()=>{const a={name:r.value.trim(),uuid:C.value};if(a.name){const s=await h.updateRole(a);s.status==="success"?(b.refetchQueries("roles"),r.value="",d.value=!1,g.value=!1,k.value="",n(s.message,"green","top")):n("There was an error","red","top-right")}else p.value="Name is required!",n("Name is required!","red","top-right")},P=()=>{d.value=!1,r.value="",C.value="",p.value=""},n=(a,s,e)=>{u.notify({message:a,color:s,position:e})},Y=a=>{const s=a.map(e=>({name:e.name,users:e.users.length,created_at:e.created_at}));H(s,B,J,u,"RolesData")};return(a,s)=>(f(),x("div",de,[m(z)?(f(),x("div",ce,"Loading roles...")):m(D)?(f(),x("div",me,"An error has occurred: "+v(m(D)),1)):(f(),V(Z,{key:2,title:"Roles",rows:m(A),columns:m(B),pagination:m(Q),"onUpdate:pagination":s[2]||(s[2]=e=>X(Q)?Q.value=e:null),separator:"cell","row-key":"name",filter:R.value,dense:""},{body:o(e=>[t(G,{props:e},{default:o(()=>[t(w,{key:"name",props:e},{default:o(()=>[N(v(e.row.name),1)]),_:2},1032,["props"]),t(w,{key:"users",props:e},{default:o(()=>[N(v(e.row.users.length),1)]),_:2},1032,["props"]),t(w,{key:"created_at",props:e},{default:o(()=>[N(v(e.row.created_at),1)]),_:2},1032,["props"]),t(w,{key:"actions",props:e},{default:o(()=>[t(q,{color:"blue",name:"edit",onClick:j=>F(e.row),style:{cursor:"pointer"},size:"20px",class:"q-mr-md"},null,8,["onClick"]),t(q,{color:"red",name:"delete",onClick:j=>I(e.row),style:{cursor:"pointer"},size:"20px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),"top-right":o(()=>[t(T,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:R.value,"onUpdate:modelValue":s[0]||(s[0]=e=>R.value=e),placeholder:"Search",class:"q-mr-md"},{append:o(()=>[t(q,{name:"search"})]),_:1},8,["modelValue"]),t(y,{onClick:L,round:"",dense:"",color:"primary",size:"small",icon:"add"}),t(y,{dense:"",flat:"",color:"primary","icon-right":"archive",label:"Export",class:"q-ml-sm","no-caps":"",onClick:s[1]||(s[1]=e=>Y(m(A)))})]),_:1},8,["rows","columns","pagination","filter"])),t(ee,{modelValue:d.value,"onUpdate:modelValue":s[4]||(s[4]=e=>d.value=e),persistent:""},{default:o(()=>[t(le,{style:{width:"500px"}},{default:o(()=>[t(U,null,{default:o(()=>[E("div",pe,v(k.value),1)]),_:1}),t(U,{class:"q-pt-none"},{default:o(()=>[t(T,{outlined:"",dense:"",label:"Name",modelValue:r.value,"onUpdate:modelValue":s[3]||(s[3]=e=>r.value=e)},null,8,["modelValue"])]),_:1}),E("div",fe,[E("small",null,v(p.value),1)]),t(te,{align:"right"},{default:o(()=>[t(y,{flat:"",label:"Cancel",color:"red",onClick:P}),t(se),r.value&&!g.value?(f(),V(y,{key:0,flat:"",label:"Add Role",color:"primary",onClick:M})):S("",!0),r.value&&g.value?(f(),V(y,{key:1,flat:"",label:"Edit Role",color:"primary",onClick:O})):S("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{qe as default};
