import{Q as h,a as H,e as J,b as K}from"./excel.c4e68fad.js";import{c6 as W,c5 as X,r as m,aI as f,a5 as C,u as c,P as v,a3 as x,bb as n,b as Y,d as a,ac as V,bV as N,c3 as g,a6 as q,a4 as U}from"./index.45153cc6.js";import{Q as $}from"./QInput.ab909322.js";import{Q as Z,a as ee,p as te,c as ae,d as re}from"./paginations.c737fe8f.js";import{a as se,Q as B}from"./QCard.f00deb23.js";import{a as ne}from"./uid.86e7d13e.js";import{a as le,u as oe}from"./index.830cf3e9.js";import{g as ie,p as E}from"./module_calls.421761b7.js";import"./use-dark.0d0b0ba9.js";import"./QSeparator.a467f888.js";import"./rtl.0b6f6848.js";import"./helpers.73a7253f.js";const z=[{name:"name",required:!0,label:"Name",align:"left",field:s=>s.name,format:s=>`${s}`,sortable:!0},{name:"users",align:"center",label:"Users",field:"users",sortable:!0},{name:"created_at",align:"center",label:"Created On",field:"created_at",sortable:!0},{name:"actions",align:"center",label:"Actions",field:"created_at"}],A=W(),i=A==null?void 0:A.token,de=X("departments",{state:()=>({departments:[]}),actions:{async fetchDepartments(){if(i){const s=await ie("departments",i);return this.departments=s==null?void 0:s.data,this.departments}},async createDepartment(s){if(i){console.log(s);const d=await E(s,"departments",i);return console.log(d),d}},async updateDepartment(s){if(i)return await E(s,"update_department",i)},async deleteDepartment(s){if(i)return await E(s,"delete_department",i)}}});const ue={class:"q-pa-md"},me={key:0},ce={key:1},pe={class:"text-h6"},fe={class:"text-center error_msg"},Ve={__name:"Departments",setup(s){const d=ne(),k=le(),y=de(),b=te(10),u=m(!1),_=m(!1),w=m(""),D=m(""),l=m(""),Q=m(""),p=m(""),{data:S,isLoading:I,isError:T}=oe("departments",()=>y.fetchDepartments()),L=async t=>{if(confirm(`Continue with the operation. Delete ${t.name} ?`)){const e=await y.deleteDepartment({uuid:t.uuid});e.status==="success"?(k.refetchQueries("departments"),o(e.message,"green","top")):o("There was an error","red","top-right")}},F=()=>{D.value="Add New Department",u.value=!0,_.value=!1},M=t=>{_.value=!0,D.value=`Edit ${t.name}`,l.value=t.name,Q.value=t.uuid,u.value=!0},O=async()=>{if(p.value="",l.value.trim()){const t=await y.createDepartment({name:l.value.trim()});t.status==="success"?(k.refetchQueries("departments"),l.value="",u.value=!1,o(t.message,"green","top")):(p.value=t.message,o(t.message,"red","top-right"))}else p.value="Name is required!",o("Name is required!","red","top-right")},P=async()=>{const t={name:l.value.trim(),uuid:Q.value};if(t.name){const r=await y.updateDepartment(t);r.status==="success"?(k.refetchQueries("departments"),l.value="",u.value=!1,_.value=!1,D.value="",o(r.message,"green","top")):o("There was an error","red","top-right")}else p.value="Name is required!",o("Name is required!","red","top-right")},R=()=>{u.value=!1,l.value="",Q.value="",p.value=""},o=(t,r,e)=>{d.notify({message:t,color:r,position:e})},j=t=>{const r=t.map(e=>({name:e.name,users:e.users.length,created_at:e.created_at}));J(r,z,K,d,"DepartmentsData")};return(t,r)=>(f(),C("div",ue,[c(I)?(f(),C("div",me,"Loading departments...")):c(T)?(f(),C("div",ce,"An error has occurred: "+v(c(T)),1)):(f(),x(Z,{key:2,title:"Departments",rows:c(S),columns:c(z),pagination:c(b),"onUpdate:pagination":r[2]||(r[2]=e=>Y(b)?b.value=e:null),separator:"cell","row-key":"name",filter:w.value,dense:""},{body:n(e=>[a(H,{props:e},{default:n(()=>[a(h,{key:"name",props:e},{default:n(()=>[V(v(e.row.name),1)]),_:2},1032,["props"]),a(h,{key:"users",props:e},{default:n(()=>[V(v(e.row.users.length),1)]),_:2},1032,["props"]),a(h,{key:"created_at",props:e},{default:n(()=>[V(v(e.row.created_at),1)]),_:2},1032,["props"]),a(h,{key:"actions",props:e},{default:n(()=>[a(N,{color:"blue",name:"edit",onClick:G=>M(e.row),style:{cursor:"pointer"},size:"20px",class:"q-mr-md"},null,8,["onClick"]),a(N,{color:"red",name:"delete",onClick:G=>L(e.row),style:{cursor:"pointer"},size:"20px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),"top-right":n(()=>[a($,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:w.value,"onUpdate:modelValue":r[0]||(r[0]=e=>w.value=e),placeholder:"Search",class:"q-mr-md"},{append:n(()=>[a(N,{name:"search"})]),_:1},8,["modelValue"]),a(g,{onClick:F,round:"",dense:"",color:"primary",size:"small",icon:"add"}),a(g,{dense:"",flat:"",color:"primary","icon-right":"archive",label:"Export",class:"q-ml-sm","no-caps":"",onClick:r[1]||(r[1]=e=>j(c(S)))})]),_:1},8,["rows","columns","pagination","filter"])),a(ee,{modelValue:u.value,"onUpdate:modelValue":r[4]||(r[4]=e=>u.value=e),persistent:""},{default:n(()=>[a(se,{style:{width:"500px"}},{default:n(()=>[a(B,null,{default:n(()=>[q("div",pe,v(D.value),1)]),_:1}),a(B,{class:"q-pt-none"},{default:n(()=>[a($,{outlined:"",dense:"",label:"Name",modelValue:l.value,"onUpdate:modelValue":r[3]||(r[3]=e=>l.value=e)},null,8,["modelValue"])]),_:1}),q("div",fe,[q("small",null,v(p.value),1)]),a(ae,{align:"right"},{default:n(()=>[a(g,{flat:"",label:"Cancel",color:"red",onClick:R}),a(re),l.value&&!_.value?(f(),x(g,{key:0,flat:"",label:"Add Department",color:"primary",onClick:O})):U("",!0),l.value&&_.value?(f(),x(g,{key:1,flat:"",label:"Edit Department",color:"primary",onClick:P})):U("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Ve as default};
