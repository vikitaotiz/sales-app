import{c1 as fe,r as c,c as ve,aI as i,a5 as T,d as t,bb as s,u as D,b as ye,a6 as u,c3 as m,bV as J,M as Y,a3 as _,P as n,ac as r,a4 as b,F as ge,aO as be,aL as he,aJ as we}from"./index.293eafd3.js";import{Q as O}from"./QInput.f16f250f.js";import{Q as ke,a as W,p as Ce,d as V,b as X,c as Z}from"./paginations.cf71abf1.js";import{Q as z}from"./QToolbar.f2249a55.js";import{Q as H}from"./QSeparator.df20a2a7.js";import{Q as E}from"./QBadge.1fca80f3.js";import{n as ee,l as le,m as y}from"./rtl.8da4134e.js";import{a as K,Q as B}from"./QCard.065a5152.js";import{p as Se,Q as Pe}from"./print.f58d3f30.js";import{a as Qe}from"./uid.31575970.js";import{u as qe}from"./sale-store.44c19f70.js";import{u as xe}from"./product-store.bebad1dd.js";import{u as Ve}from"./payment-mode-store.d05e5510.js";import{a as Be,u as R}from"./index.af0e9988.js";import"./use-dark.ae53736e.js";import"./_commonjsHelpers.6150b38b.js";import"./module_calls.421761b7.js";import"./helpers.73a7253f.js";const $e=(g,p)=>{const $=g.reduce((N,h)=>N+h.total,0);return`<div style="text-align: center; padding: 10px; border: 1px solid grey; paddinng: 5px; margin-bottom: 20px; width: 100%">
    <h1>${p.title}</h1>
    <ul>
      <li>Total Cost : ${$}</li>
      <li>Payment Mode : ${p.payment_mode}</li>
      <li>Status : ${p.status}</li>
      <li>Created By : ${p.user}</li>
      <li>Created On : ${p.created_at}</li>
      </li>
    </ul>
  </div>`},Ne=(g,p,$)=>{const P=$e(g,$);Se({header:P,printable:g,properties:p,type:"json",gridHeaderStyle:"font-weight: bold; border: 2px solid;",gridStyle:"border-collapse: collapse; border: 1px solid;"})};const S=g=>(he("data-v-24ed40fa"),g=g(),we(),g),Ie={class:"q-pa-md"},Ae={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},Ue={key:1,class:"text-center"},De={class:"text-center"},Me=S(()=>u("br",null,null,-1)),Te=S(()=>u("hr",null,null,-1)),Ee=S(()=>u("hr",null,null,-1)),Fe=S(()=>u("hr",null,null,-1)),Le=S(()=>u("b",null,"Add Product",-1)),Oe={key:0},ze=S(()=>u("hr",null,null,-1)),He={class:"text-center error_msg"},Ke=S(()=>u("div",{class:"text-h6"},"Make Payment",-1)),Re={class:"q-mt-sm"},je={class:"text-center error_msg"},Ge={__name:"Bills",setup(g){const p=Be(),$=Qe(),P=Ce(10),N=c(""),h=qe(),te=xe(),ae=Ve(),w=c(!1),M=c(!0),I=c(!1),Q=c(1),k=c(1),f=c(""),d=c(""),A=c(""),q=c(""),x=c([]),U=c([]),{data:F}=R("bills",()=>h.fetchBills(),{onSuccess:a=>{U.value=a.map(l=>({user:l.user,uuid:l.uuid,status:l.status,payment_mode:l.payment_mode,selling_price:l.selling_price,actual_selling_price:l.actual_selling_price,created_at:l.created_at,sales:l.sales}))}});R("products",()=>te.fetchProducts(),{onSuccess:a=>{x.value=a.map(l=>({uuid:l.uuid,name:l.name,price:l.selling_price,category:l.category,department:l.department}))}});const{data:se}=R("payment_modes",()=>ae.fetchPaymentModes()),L=c(x.value),oe=a=>{f.value=a,w.value=!0},j=ve(()=>{let a=0;return f.value.sales.forEach(l=>{a+=l.selling_price*l.quantity}),a}),ue=a=>{f.value=a,I.value=!0},ne=()=>{w.value=!1,d.value="",Q.value=1,q.value=""},re=async()=>{if(f.value.sales.some(a=>a.name===d.value.name))q.value="Product already added to the bill",v("Product already added to the bill","red","top-right");else{const a=await h.addProductToBill({bill_uuid:f.value.uuid,uuid:d.value.uuid,name:d.value.name,selling_price:d.value.price,quantity:Q.value});a.status=="success"?(p.refetchQueries("bills"),v(a.message,"green","top")):(f.value="",w.value=!1,v(a.message,"red","top"))}},ie=()=>{I.value=!1},de=async a=>{if(confirm("Are you sure?")){const e=await h.removeProductFromBill({product_uuid:a.uuid});e.status=="success"?(p.refetchQueries("bills"),v(e.message,"green","top")):(f.value="",w.value=!1,v(e.message,"red","top"))}},ce=async a=>{if(confirm("Are you sure?")){const e=await h.deleteBill({bill_uuid:a.uuid});e.status=="success"?(p.refetchQueries("bills"),v(e.message,"green","top")):(f.value="",w.value=!1,v(e.message,"red","top"))}},me=async()=>{let a=[];f.value.sales.forEach(e=>a.push({name:e.name,quantity:e.quantity,uuid:e.uuid}));const l={products:a,bill_uuid:f.value.uuid,selling_price:Number(j.value),actual_selling_price:k.value?Number(k.value.trim()):0,payment_mode_uuid:A.value.uuid,bill_status:"sold"};if(l.actual_selling_price&&l.payment_mode_uuid){const e=await h.updateSaleOperation(l);e.status==="success"?(p.refetchQueries("bills"),A.value="",Q.value="",I.value=!1,v(e.message,"green","top")):(q.value=e.message,v(e.message,"red","top-right"))}else q.value="Name is required!",v("Name is required!","red","top-right")},pe=(a,l)=>{a.length>0&&(x.value.includes(a)||x.value.push(a),l(a,"toggle"))},_e=(a,l)=>{l(()=>{if(a==="")L.value=x.value;else{const e=a.toLowerCase();L.value=x.value.filter(o=>o.name.toLowerCase().indexOf(e)>-1)}})},G=a=>{const l=[];a.sales.forEach(o=>{l.push({name:o.name,quantity:o.quantity,price:o.selling_price,total:o.quantity*o.selling_price})});const e={title:"Sales Receipt",status:a.status==="sold"?"Sold":"Pending Payment",user:a.user,payment_mode:a.payment_mode};Ne(l,["name","quantity","price","total"],e)},v=(a,l,e)=>{$.notify({message:a,color:l,position:e})};return(a,l)=>(i(),T("div",Ie,[t(ke,{grid:"",flat:"",bordered:"",title:"Sold/Pending Bills",rows:U.value,"row-key":"user",filter:N.value,pagination:D(P),"onUpdate:pagination":l[4]||(l[4]=e=>ye(P)?P.value=e:null)},{"top-right":s(()=>[u("div",null,[t(m,{rounded:"",dense:"",outline:"",color:"primary",push:"",label:"All Bills",onClick:l[0]||(l[0]=e=>{var o;return U.value=(o=D(F))==null?void 0:o.filter(C=>C)}),class:"q-mr-sm"}),t(m,{rounded:"",dense:"",outline:"",color:"blue",push:"",label:"Sold Bills",onClick:l[1]||(l[1]=e=>{var o;return U.value=(o=D(F))==null?void 0:o.filter(C=>C.status==="sold")}),class:"q-mr-sm"}),t(m,{rounded:"",dense:"",outline:"",color:"brown",push:"",label:"Pending Bills",onClick:l[2]||(l[2]=e=>{var o;return U.value=(o=D(F))==null?void 0:o.filter(C=>C.status==="pending")}),class:"q-mr-sm"})]),t(O,{rounded:"",outlined:"",dense:"",debounce:"300",modelValue:N.value,"onUpdate:modelValue":l[3]||(l[3]=e=>N.value=e),placeholder:"Search"},{append:s(()=>[t(J,{name:"search"})]),_:1},8,["modelValue"])]),item:s(e=>[u("div",Ae,[t(K,{bordered:"",class:Y(`${e.row.status=="pending"?"sale_pending":""}`)},{default:s(()=>[t(B,null,{default:s(()=>[e.row.status==="pending"?(i(),_(z,{key:0},{default:s(()=>[u("strong",null,"Created by : "+n(e.row.user),1),r(),t(V),t(m,{round:"",dense:"",color:"primary",size:"small",icon:"add",onClick:o=>oe(e.row)},null,8,["onClick"]),t(m,{dense:"",flat:"",round:"",color:"red",icon:"delete",onClick:o=>ce(e.row)},null,8,["onClick"])]),_:2},1024)):(i(),T("div",Ue,[u("strong",null,"Created by : "+n(e.row.user),1),r(),t(V)])),t(H,{class:"q-mb-sm"}),u("div",De,[u("small",null,"Created On : "+n(e.row.created_at),1),r(),Me,u("small",null,[t(E,{color:`${e.row.status=="pending"?"red":""}`},{default:s(()=>[r("Status : "+n(e.row.status),1)]),_:2},1032,["color"])])]),t(H,{class:"q-mb-sm"}),t(ee,{dense:"",bordered:"",separator:"",class:"bill"},{default:s(()=>[t(le,null,{default:s(()=>[t(y,null,{default:s(()=>[r("Name")]),_:1}),t(y,null,{default:s(()=>[r("Price")]),_:1}),t(y,{style:{color:"white"}},{default:s(()=>[r("Quantity")]),_:1}),t(y,{style:{color:"white"}},{default:s(()=>[r("Total")]),_:1}),e.row.status==="pending"?(i(),_(y,{key:0},{default:s(()=>[r("Action")]),_:1})):b("",!0)]),_:2},1024)]),_:2},1024),t(ee,{dense:"",bordered:"",separator:""},{default:s(()=>[(i(!0),T(ge,null,be(e.row.sales,(o,C)=>(i(),_(le,{key:C},{default:s(()=>[t(y,null,{default:s(()=>[r(n(o.name),1)]),_:2},1024),t(y,null,{default:s(()=>[r(n(o.selling_price),1)]),_:2},1024),t(y,null,{default:s(()=>[r(n(o.quantity),1)]),_:2},1024),t(y,null,{default:s(()=>[r(n(o.quantity*o.selling_price),1)]),_:2},1024),e.row.status==="pending"?(i(),_(y,{key:0},{default:s(()=>[t(J,{name:"delete",color:"red",onClick:Je=>de(o),style:{cursor:"pointer"}},null,8,["onClick"])]),_:2},1024)):b("",!0)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024),t(H),t(B,{class:"flex flex-center"},{default:s(()=>[u("b",null,"Expected Price Ksh "+n(e.row.selling_price),1),Te,u("b",null,"Actual Price Ksh "+n(e.row.actual_selling_price),1),Ee,u("small",null,"Mode : "+n(e.row.payment_mode),1)]),_:2},1024),Fe,t(B,{style:{padding:"0"}},{default:s(()=>[e.row.status==="sold"?(i(),_(m,{key:0,class:"full-width",dense:"",flat:"",onClick:o=>G(e.row),label:"Print Bill",icon:"download",color:"primary"},null,8,["onClick"])):(i(),_(Pe,{key:1,push:"",class:"full-width"},{default:s(()=>[t(m,{class:"full-width",dense:"",flat:"",onClick:o=>G(e.row),label:"Print Bill",icon:"download",color:"primary"},null,8,["onClick"]),t(m,{dense:"",flat:"",push:"",color:"orange",class:"full-width",label:"Sale",icon:"dashboard",onClick:o=>ue(e.row)},null,8,["onClick"])]),_:2},1024))]),_:2},1024)]),_:2},1032,["class"])])]),_:1},8,["rows","filter","pagination"]),t(W,{modelValue:w.value,"onUpdate:modelValue":l[7]||(l[7]=e=>w.value=e),persistent:""},{default:s(()=>[t(K,{style:{width:"500px"}},{default:s(()=>[t(B,null,{default:s(()=>[t(z,null,{default:s(()=>[Le,t(V),d.value?(i(),T("small",Oe,[t(E,{class:"q-mr-sm",color:"blue"},{default:s(()=>[r("Price: "+n(d.value.price),1)]),_:1}),t(E,{class:"q-mr-sm",color:"blue"},{default:s(()=>[r("Category: "+n(d.value.category),1)]),_:1}),t(E,{class:"q-mr-sm",color:"blue"},{default:s(()=>[r("Department: "+n(d.value.department),1)]),_:1})])):b("",!0)]),_:1}),ze,t(X,{dense:"","use-input":"",outlined:"",modelValue:d.value,"onUpdate:modelValue":l[5]||(l[5]=e=>d.value=e),"input-debounce":"0",onNewValue:pe,options:L.value,onFilter:_e,"option-value":"uuid","option-label":"name",label:"Select Product to add",hint:"You can type in the product name for quick search..."},null,8,["modelValue","options"])]),_:1}),t(B,{class:"q-pt-none"},{default:s(()=>[d.value?(i(),_(O,{key:0,outlined:"",dense:"",label:"Product Quantity",modelValue:Q.value,"onUpdate:modelValue":l[6]||(l[6]=e=>Q.value=e),type:"number"},null,8,["modelValue"])):b("",!0)]),_:1}),u("div",He,[u("small",null,n(q.value),1)]),t(Z,{align:"right"},{default:s(()=>[t(m,{flat:"",label:"Cancel",color:"red",onClick:ne}),t(V),Q.value&&d.value?(i(),_(m,{key:0,flat:"",label:"Add Product",color:"primary",onClick:re})):b("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(W,{modelValue:I.value,"onUpdate:modelValue":l[11]||(l[11]=e=>I.value=e),persistent:""},{default:s(()=>[t(K,{style:{width:"500px"}},{default:s(()=>[t(z,null,{default:s(()=>[Ke,t(V),u("small",Re,[t(m,{dense:"",color:"blue",depressed:"",class:Y(`${M.value?"":"actual_selling_price"}`),onClick:l[8]||(l[8]=e=>M.value=!M.value),label:`Expected Selling Price : ${j.value}`},null,8,["class","label"])])]),_:1}),t(B,{class:"q-pt-none"},{default:s(()=>[M.value?b("",!0):(i(),_(O,{key:0,autofocus:"",outlined:"",dense:"",label:"Actual Selling Price",modelValue:k.value,"onUpdate:modelValue":l[9]||(l[9]=e=>k.value=e),class:"q-pa-xs col-xs-12 col-sm-6 col-md-6 q-mb-sm",type:"number"},null,8,["modelValue"])),k.value&&k.value>0?(i(),_(X,{key:1,dense:"",outlined:"",modelValue:A.value,"onUpdate:modelValue":l[10]||(l[10]=e=>A.value=e),options:D(se),"option-value":"uuid","option-label":"name",label:"Select Payment Mode"},null,8,["modelValue","options"])):b("",!0)]),_:1}),u("div",je,[u("small",null,n(q.value),1)]),t(Z,{align:"right"},{default:s(()=>[t(m,{flat:"",label:"Cancel",color:"red",onClick:ie}),t(V),k.value&&A.value?(i(),_(m,{key:0,flat:"",label:"Sale",color:"primary",onClick:me})):b("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};var _l=fe(Ge,[["__scopeId","data-v-24ed40fa"]]);export{_l as default};
