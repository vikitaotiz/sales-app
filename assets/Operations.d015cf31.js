import{c5 as de,r as c,c as ie,aI as _,a5 as P,a6 as o,P as u,u as g,a3 as Q,bb as a,b as ce,d as e,a4 as C,bD as k,ac as r,F as me,aO as pe,bE as y,M as _e}from"./index.5fb5782a.js";import{Q as O}from"./QBadge.0dc603ef.js";import{a as N,Q as B}from"./QCard.26ee33d1.js";import{Q as E}from"./QInput.717f10d2.js";import{Q as ve,a as H,p as fe,c as U,d as V,b as ye}from"./paginations.2a067bbb.js";import{p as F,n as M,o as d}from"./rtl.71c682ab.js";import{Q as ge}from"./QSeparator.3551e858.js";import{Q as be}from"./QBtnGroup.8ee1e134.js";import{Q as R}from"./QToolbar.697fd95d.js";import{a as he}from"./use-quasar.90be0ad1.js";import{u as j}from"./index.98993c44.js";import{p as qe}from"./product_columns.33f8ffe3.js";import{u as Qe}from"./product-store.bedbceaa.js";import{u as ke}from"./payment-mode-store.6932f410.js";import{u as Se}from"./sale-store.38f59fab.js";import{p as xe}from"./print.15699711.js";import"./use-dark.a05d927d.js";import"./module_calls.421761b7.js";import"./helpers.73a7253f.js";import"./_commonjsHelpers.6150b38b.js";const we={class:"q-pa-md"},Pe={class:"row",style:{overflow:"hidden"}},Ce={class:"q-pa-xs col-xs-12 col-sm-6 col-md-7",style:{overflow:"auto"}},Ve={style:{color:"red"}},Ne={key:0},Be={key:1},$e=["onClick"],Ae={style:{color:"#017951"}},De=o("hr",null,null,-1),Ee=o("hr",null,null,-1),Ue=o("br",null,null,-1),Me=o("br",null,null,-1),Ie=o("br",null,null,-1),Le={key:0,class:"q-pa-xs col-xs-12 col-sm-6 col-md-5",style:{overflow:"auto"}},Te={style:{color:"orange"}},Oe=o("br",null,null,-1),He=o("br",null,null,-1),Fe=o("hr",null,null,-1),Re={class:"text-h6"},je={class:"text-center error_msg"},ze=o("div",{class:"text-h6"},"Make Payment",-1),Ge={class:"q-mt-sm"},Ke={class:"text-center error_msg"},yl={__name:"Operations",setup(Ye){const I=de(),z=he(),G=Qe(),K=ke(),L=Se(),$=fe(10),b=c(!1),S=c(!1),x=c(!0),A=c(""),i=c(1),h=c(1),q=c(""),Y=c(""),v=c(""),D=c(""),m=c(""),n=c([]),{data:J,isLoading:W,isError:T}=j("products",()=>G.fetchProducts()),{data:X}=j("payment_modes",()=>K.fetchPaymentModes()),Z=s=>{v.value="",D.value="",n.value.some(t=>t.name==s.name)?(v.value="Product already added to the bill! Select a different product.",D.value="Product already added to the bill! Select a different product.",f(`${s.name} already added to the bill!`,"red","top")):(S.value=!0,m.value=s)},ee=()=>{b.value=!0},le=()=>{S.value=!1,m.value="",i.value=1},ae=()=>{if(i.value>m.value.quantity)v.value=`${i.value} is more than the maximum available quantity`,f(`${i.value} is more than the maximum available quantity`,"red","top");else{const s={uuid:m.value.uuid,name:m.value.name,price:m.value.selling_price,quantity:i.value};n.value.push(s),f(`${m.value.name} added to cart!`,"green","top"),S.value=!1,m.value="",i.value=1}},w=ie(()=>{let s=0;return n.value.forEach(t=>{s+=t.quantity*t.price}),s}),te=s=>n.value.splice(s,1),oe=()=>{confirm("Are you sure?")&&(n.value=[])},se=async()=>{let s=[];n.value.forEach(l=>s.push({name:l.name,quantity:l.quantity,uuid:l.uuid}));const t={products:s,payment_mode_uuid:q.value.uuid,bill_status:"sold"};if(x.value?(t.selling_price=Number(w.value),t.actual_selling_price=Number(w.value)):(t.selling_price=Number(w.value),t.actual_selling_price=Number(h.value)),t.selling_price&&t.payment_mode_uuid){const l=await L.createSaleOperation(t);l.status==="success"?(q.value="",i.value="",b.value=!1,n.value=[],I.push("/bills"),f(l.message,"green","top")):(v.value=l.message,f(l.message,"red","top-right"))}else v.value="Name is required!",f("Name is required!","red","top-right")},ue=async()=>{var l;let s=[];n.value.forEach(p=>s.push({name:p.name,quantity:p.quantity,uuid:p.uuid}));const t={products:s};if((l=t==null?void 0:t.products)!=null&&l.length){const p=await L.createHoldBillOperation(t);p.status==="success"?(q.value="",i.value="",b.value=!1,n.value=[],I.push("/bills"),f(p.message,"green","top")):(v.value=p.message,f(p.message,"red","top-right"))}else v.value="Name is required!",f("Name is required!","red","top-right")},re=()=>{b.value=!1,i.value="",Y.value="",v.value=""},f=(s,t,l)=>{z.notify({message:s,color:t,position:l})},ne=()=>{xe({printable:n.value,properties:["name","quantity"],type:"json",gridHeaderStyle:"color: red;  border: 2px solid #3971A5;",gridStyle:"border: 2px solid #3971A5;"})};return(s,t)=>(_(),P("div",we,[o("div",Pe,[o("div",Ce,[o("small",Ve,u(D.value),1),g(W)?(_(),P("div",Ne,"Loading products...")):g(T)?(_(),P("div",Be,"An error has occurred: "+u(g(T)),1)):(_(),Q(ve,{key:2,title:"Make Sale (All Products)",rows:g(J),columns:g(qe),pagination:g($),"onUpdate:pagination":t[1]||(t[1]=l=>ce($)?$.value=l:null),separator:"cell","row-key":"name",filter:A.value,dense:"",grid:""},{item:a(l=>[o("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4",onClick:p=>Z(l.row)},[e(N,{bordered:"",class:"selected_product"},{default:a(()=>[e(B,{class:"text-center"},{default:a(()=>[o("strong",Ae,[e(k,{name:"bubble_chart"}),r(" "+u(l.row.name),1)]),De,o("small",null,[o("i",null,[r("Selling Price: "),o("b",null,"Ksh "+u(l.row.selling_price),1)])]),Ee,o("small",null,[o("i",null,"Category: "+u(l.row.category),1)]),Ue,o("small",null,[o("i",null,"Department: "+u(l.row.department),1)]),Me,o("small",null,[e(O,{color:"orange"},{default:a(()=>[r("Available Quantity "),Ie,r(u(l.row.quantity)+" "+u(l.row.measurement),1)]),_:2},1024)])]),_:2},1024)]),_:2},1024)],8,$e)]),"top-right":a(()=>[e(E,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:A.value,"onUpdate:modelValue":t[0]||(t[0]=l=>A.value=l),placeholder:"Search product...",class:"q-mr-md"},{append:a(()=>[e(k,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","pagination","filter"]))]),n.value.length>0?(_(),P("div",Le,[e(N,{bordered:""},{default:a(()=>[e(U,null,{default:a(()=>[o("i",null,[e(k,{name:"shopping_cart"}),r(" New Bill")]),r(),e(V),o("span",Te,"(Items: "+u(n.value.length)+")",1)]),_:1}),e(B,null,{default:a(()=>[e(F,{bordered:"",separator:"",dense:"",class:"bill"},{default:a(()=>[e(M,null,{default:a(()=>[e(d,null,{default:a(()=>[r("Name")]),_:1}),e(d,{style:{color:"white"}},{default:a(()=>[r("Price")]),_:1}),e(d,{style:{color:"white"}},{default:a(()=>[r("Quantity")]),_:1}),e(d,{side:"",style:{color:"white"}},{default:a(()=>[r("Total")]),_:1}),e(d,{avatar:""},{default:a(()=>[e(k,{class:"select_list",name:"delete",dense:"",color:"white",onClick:oe})]),_:1})]),_:1})]),_:1}),Oe,e(F,{bordered:"",separator:"",dense:""},{default:a(()=>[(_(!0),P(me,null,pe(n.value,(l,p)=>(_(),Q(M,{key:l.uuid},{default:a(()=>[e(d,null,{default:a(()=>[r(u(l.name),1)]),_:2},1024),e(d,null,{default:a(()=>[r(u(l.price),1)]),_:2},1024),e(d,null,{default:a(()=>[r(u(l.quantity),1)]),_:2},1024),e(d,{side:""},{default:a(()=>[r(u(l.price*l.quantity),1)]),_:2},1024),e(d,{avatar:""},{default:a(()=>[e(k,{class:"select_list",name:"delete",dense:"",color:"red",onClick:Je=>te(p)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(ge,{color:"orange"}),e(M,null,{default:a(()=>[e(d,null,{default:a(()=>[r("Total")]),_:1}),e(d,{avatar:""},{default:a(()=>[r(u(w.value),1)]),_:1}),e(d,{avatar:""})]),_:1})]),_:1}),He,e(be,{spread:"",rounded:""},{default:a(()=>[e(y,{dense:"",color:"primary",label:"Sale",icon:"grain",onClick:ee}),e(y,{dense:"",color:"orange",label:"Hold Bill",icon:"pan_tool",onClick:ue})]),_:1}),Fe,e(y,{color:"primary",flat:"",dense:"",class:"full-width",label:"Print Bill",icon:"print",onClick:ne})]),_:1})]),_:1})])):C("",!0)]),e(H,{modelValue:S.value,"onUpdate:modelValue":t[3]||(t[3]=l=>S.value=l),persistent:""},{default:a(()=>[e(N,{style:{width:"500px"}},{default:a(()=>[e(R,null,{default:a(()=>[o("div",Re,[e(k,{name:"bubble_chart"}),r(" "+u(m.value.name),1)]),e(V),o("small",null,[e(O,null,{default:a(()=>[r(u(m.value.measurement),1)]),_:1})])]),_:1}),e(B,{class:"q-pt-none"},{default:a(()=>[e(E,{autofocus:"",outlined:"",dense:"",label:"Product Quantity",modelValue:i.value,"onUpdate:modelValue":t[2]||(t[2]=l=>i.value=l),type:"number",hint:`Note : You can sale a maximum of ${m.value.quantity}`},null,8,["modelValue","hint"])]),_:1}),o("div",je,[o("small",null,u(v.value),1)]),e(U,{align:"right"},{default:a(()=>[e(y,{flat:"",label:"Cancel",color:"red",onClick:le}),e(V),i.value?(_(),Q(y,{key:0,flat:"",label:"Add Product",color:"primary",onClick:ae})):C("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(H,{modelValue:b.value,"onUpdate:modelValue":t[7]||(t[7]=l=>b.value=l),persistent:""},{default:a(()=>[e(N,{style:{width:"500px"}},{default:a(()=>[e(R,null,{default:a(()=>[ze,e(V),o("small",Ge,[e(y,{dense:"",outline:"",color:"blue",depressed:"",class:_e(`${x.value?"":"actual_selling_price"}`),onClick:t[4]||(t[4]=l=>x.value=!x.value),label:`Expected Selling Price : ${w.value}`},null,8,["class","label"])])]),_:1}),e(B,{class:"q-pt-none"},{default:a(()=>[x.value?C("",!0):(_(),Q(E,{key:0,autofocus:"",outlined:"",dense:"",label:"Actual Selling Price",modelValue:h.value,"onUpdate:modelValue":t[5]||(t[5]=l=>h.value=l),class:"q-pa-xs col-xs-12 col-sm-6 col-md-6 q-mb-sm",type:"number"},null,8,["modelValue"])),h.value&&h.value>0?(_(),Q(ye,{key:1,dense:"",outlined:"",modelValue:q.value,"onUpdate:modelValue":t[6]||(t[6]=l=>q.value=l),options:g(X),"option-value":"uuid","option-label":"name",label:"Select Payment Mode"},null,8,["modelValue","options"])):C("",!0)]),_:1}),o("div",Ke,[o("small",null,u(v.value),1)]),e(U,{align:"right"},{default:a(()=>[e(y,{flat:"",label:"Cancel",color:"red",onClick:re}),e(V),h.value&&q.value?(_(),Q(y,{key:0,flat:"",label:"Sale",color:"primary",onClick:se})):C("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{yl as default};
